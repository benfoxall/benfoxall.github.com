function unique(){return"x"+ ++NOW+ +new Date}function rnow(){return+new Date}function build_url(a,b){var c=a.join(URLBIT),d=[];return b?(each(b,function(a,b){d.push(a+"="+encode(b))}),c+="?"+d.join(PARAMSBIT)):c}function updater(a,b){var c,d=0,e=function(){d+b>rnow()?(clearTimeout(c),c=setTimeout(e,b)):(d=rnow(),a())};return e}function grep(a,b){var c=[];return each(a||[],function(a){b(a)&&c.push(a)}),c}function supplant(a,b){return a.replace(REPL,function(a,c){return b[c]||a})}function timeout(a,b){return setTimeout(a,b)}function uuid(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)});return a&&a(b),b}function each(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;d>c;)b.call(a[c],a[c],c++);else for(var c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function map(a,b){var c=[];return each(a||[],function(a,d){c.push(b(a,d))}),c}function encode(a){return map(encodeURIComponent(a).split(""),function(a){return"-_.!~*'()".indexOf(a)<0?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function generate_channel_list(a){var b=[];return each(a,function(a,c){c.subscribed&&b.push(a)}),b.sort()}function ready(){timeout(function(){READY||(READY=1,each(READY_BUFFER,function(a){a()}))},SECOND)}function PN_API(a){function b(a){a&&(s.sending=0),!s.sending&&s.length&&(s.sending=1,z(s.shift()))}function c(a){var b=0;return each(generate_channel_list(y),function(c){var d=y[c];d&&(b++,(a||function(){})(d))}),b}function d(){B()||f(1),timeout(d,SECOND)}function e(){F.time(function(a){a||f(1),timeout(e,i)})}function f(a){v&&v(a),v=null}var g=+a.windowing||DEF_WINDOWING,h=(+a.timeout||DEF_SUB_TIMEOUT)*SECOND,i=(+a.keepalive||DEF_KEEPALIVE)*SECOND,j=a.noleave||0,k=a.publish_key||"",l=a.subscribe_key||"",m=a.auth_key||"",n=a.ssl?"s":"",o="http"+n+"://"+(a.origin||"pubsub.pubnub.com"),p=nextorigin(o),q=nextorigin(o),r=function(){},s=[],t=0,u=0,v=0,w=0,x=0,y={},z=a.xdr,A=a.error||function(){},B=a._is_online||function(){return 1},C=a.jsonp_cb||function(){return 0},D=a.db||{get:function(){},set:function(){}},E=a.uuid||D&&D.get(l+"uuid")||"",F={LEAVE:function(a,b){var c={uuid:E,auth:m},d=nextorigin(o),e=C();a.indexOf(PRESENCE_SUFFIX)>0||j||("0"!=e&&(c.callback=e),z({blocking:b||n,timeout:2e3,callback:e,data:c,url:[d,"v2","presence","sub_key",l,"channel",encode(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||function(){},f=a.channel,g=a.start,h=a.end,i={},j=C();return f?b?l?(i.stringtoken="true",i.count=c,i.reverse=d,i.auth=m,j&&(i.callback=j),g&&(i.start=g),h&&(i.end=h),z({callback:j,data:i,success:function(a){b(a)},fail:e,url:[p,"v2","history","sub-key",l,"channel",encode(f)]}),void 0):A("Missing Subscribe Key"):A("Missing Callback"):A("Missing Channel")},replay:function(a){var b,c=c||a.callback||function(){},d=a.source,e=a.destination,f=a.stop,g=a.start,h=a.end,i=a.reverse,j=a.limit,n=C(),o={};return d?e?k?l?("0"!=n&&(o.callback=n),f&&(o.stop="all"),i&&(o.reverse="true"),g&&(o.start=g),h&&(o.end=h),j&&(o.count=j),o.auth=m,b=[p,"v1","replay",k,l,d,e],z({callback:n,success:function(a){c(a)},fail:function(){c([0,"Disconnected"])},url:b,data:o}),void 0):A("Missing Subscribe Key"):A("Missing Publish Key"):A("Missing Destination Channel"):A("Missing Source Channel")},auth:function(a){m=a,r()},time:function(a){var b=C();z({callback:b,data:{uuid:E,auth:m},timeout:5*SECOND,url:[p,"time",b],success:function(b){a(b[0])},fail:function(){a(0)}})},publish:function(a,c){var d,c=c||a.callback||function(){},e=a.message,f=a.channel,g=C();return e?f?k?l?(e=JSON.stringify(e),d=[p,"publish",k,l,0,encode(f),g,encode(e)],s.push({callback:g,timeout:5*SECOND,url:d,data:{uuid:E,auth:m},success:function(a){c(a),b(1)},fail:function(){c([0,"Failed",e]),b(1)}}),b(),void 0):A("Missing Subscribe Key"):A("Missing Publish Key"):A("Missing Channel"):A("Missing Message")},unsubscribe:function(a){var b=a.channel;x=0,w=1,b=map((b.join?b.join(","):""+b).split(","),function(a){return a+","+a+PRESENCE_SUFFIX}).join(","),each(b.split(","),function(a){READY&&F.LEAVE(a,0),y[a]=0}),r()},subscribe:function(a,b){function d(a){a?timeout(r,SECOND):(p=nextorigin(o,1),q=nextorigin(o,1),timeout(function(){F.time(d)},SECOND)),c(function(b){return a&&b.disconnected?(b.disconnected=0,b.reconnect(b.name)):(a||b.disconnected||(b.disconnected=1,b.disconnect(b.name)),void 0)})}function e(){var a=C(),b=generate_channel_list(y).join(",");b&&(f(),v=z({timeout:J,callback:a,fail:function(){v=null,F.time(d)},data:{uuid:E,auth:m},url:[q,"subscribe",l,encode(b),a,x],success:function(a){if(v=null,!a||"object"==typeof a&&"error"in a&&!a.error)return s(a),timeout(r,K);x=!x&&w&&D.get(l)||a[1],c(function(a){a.connected||(a.connected=1,a.connect(a.name))}),H&&(x=1e4,H=0),D.set(l,a[1]);var b=function(){var b=a.length>2?a[2]:map(y,function(b){return map(Array(a[0].length).join(",").split(","),function(){return b})}).join(","),c=b.split(",");return function(){var a=c.shift()||u;return[(y[a]||{}).callback||t,a.split(PRESENCE_SUFFIX)[0]]}}();each(a[0],function(c){var d=b();d[0](c,a,d[1])}),timeout(e,K)}}))}var i=a.channel,b=b||a.callback,b=b||a.message,j=a.connect||function(){},k=a.reconnect||function(){},n=a.disconnect||function(){},s=a.error||function(){},B=a.presence||0,G=a.noheresync||0,H=a.backfill||0,I=a.timetoken||0,J=a.timeout||h,K=a.windowing||g,L=a.restore;return w=L,x=I,i?b?l?(each((i.join?i.join(","):""+i).split(","),function(a){var c=y[a]||{};y[u=a]={name:a,connected:c.connected,disconnected:c.disconnected,subscribed:1,callback:t=b,connect:j,disconnect:n,reconnect:k},B&&(F.subscribe({channel:a+PRESENCE_SUFFIX,callback:B}),c.subscribed||G||F.here_now({channel:a,callback:function(b){each("uuids"in b?b.uuids:[],function(c){B({action:"join",uuid:c,timestamp:rnow(),occupancy:b.occupancy||1},b,a)})}}))}),r=function(){f(),timeout(e,K)},READY?(r(),void 0):READY_BUFFER.push(r)):A("Missing Subscribe Key"):A("Missing Callback"):A("Missing Channel")},here_now:function(a,b){var b=a.callback||b,c=a.error||function(){},d=a.channel,e=C(),f={uuid:E,auth:m};return d?b?l?("0"!=e&&(f.callback=e),z({callback:e,data:f,success:function(a){b(a,d)},fail:c,url:[p,"v2","presence","sub_key",l,"channel",encode(d)]}),void 0):A("Missing Subscribe Key"):A("Missing Callback"):A("Missing Channel")},xdr:z,ready:ready,db:D,uuid:uuid,map:map,each:each,"each-channel":c,grep:grep,offline:function(){f(1)},supplant:supplant,now:rnow,unique:unique,updater:updater};return E||(E=F.uuid()),D.set(l+"uuid",E),timeout(d,SECOND),timeout(e,i),F.time(function(){}),F}function Vector(){}function Matrix(){}function Line(){}function Plane(){}function partyHandler(){}function show(a,b){var c=document.getElementById(b);if(c)for(var d=document.getElementsByClassName(a),e=0;e<d.length;e++)d[e].className=d[e]===c?a+" on":a}function coordecode(a,b){var c=0,d=0;if(!a)var a=window.event;a.pageX||a.pageY?(c=a.pageX,d=a.pageY):(a.clientX||a.clientY)&&(c=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);var e=b.getBoundingClientRect();return{x:c-e.left-e.width/2,y:d-e.top-e.height/2}}function touchCoord(a,b){var c=a.touches[0].pageX,d=a.touches[0].pageY,e=b.getBoundingClientRect();return{x:c-e.left-e.width/2,y:d-e.top-e.height/2}}function feedback(a){blob.style.backgroundColor=innerC,inner.style.backgroundColor=outerC,blob.style.webkitTransform="translate3D("+a.x/3+"px, "+a.y/3+"px, 0)",fTimeout&&clearTimeout(fTimeout),fTimeout=setTimeout(function(){blob.style.backgroundColor=outerC,inner.style.backgroundColor=innerC,blob.style.webkitTransform=""},100)}function throttle(a,b){var c,d;return function(e){d=e,c||(c=setTimeout(function(){a(d),c=null},b))}}function publishDimensions(){var a={id:uuid,width:window.innerWidth,height:window.innerHeight};pubnub.publish({channel:"idmt-dimensions",message:a}),console.log(a)}function css(a){return"matrix("+[a.e(1,1),a.e(2,1),a.e(1,2),a.e(2,2),a.e(1,3),a.e(2,3)].join(", ")+")"}window.Modernizr=function(a,b,c){function d(a){s.cssText=a}function e(a,b){return typeof a===b}function f(a,b){return!!~(""+a).indexOf(b)}function g(a,b){for(var d in a){var e=a[d];if(!f(e,"-")&&s[e]!==c)return"pfx"==b?e:!0}return!1}function h(a,b,d){for(var f in a){var g=b[a[f]];if(g!==c)return d===!1?a[f]:e(g,"function")?g.bind(d||b):g}return!1}function i(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),f=(a+" "+v.join(d+" ")+d).split(" ");return e(b,"string")||e(b,"undefined")?g(f,b):(f=(a+" "+w.join(d+" ")+d).split(" "),h(f,b,c))}var j,k,l,m="2.6.2",n={},o=!0,p=b.documentElement,q="modernizr",r=b.createElement(q),s=r.style,t=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),u="Webkit Moz O ms",v=u.split(" "),w=u.toLowerCase().split(" "),x={},y=[],z=y.slice,A=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:q+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',q,'">',a,"</style>"].join(""),j.id=q,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=p.style.overflow,p.style.overflow="hidden",p.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),p.style.overflow=i),!!g},B=function(){function a(a,f){f=f||b.createElement(d[a]||"div"),a="on"+a;var g=a in f;return g||(f.setAttribute||(f=b.createElement("div")),f.setAttribute&&f.removeAttribute&&(f.setAttribute(a,""),g=e(f[a],"function"),e(f[a],"undefined")||(f[a]=c),f.removeAttribute(a))),f=null,g}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),C={}.hasOwnProperty;l=e(C,"undefined")||e(C.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return C.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=z.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(z.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(z.call(arguments)))};return d}),x.webgl=function(){return!!a.WebGLRenderingContext},x.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:A(["@media (",t.join("touch-enabled),("),q,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},x.geolocation=function(){return"geolocation"in navigator},x.indexedDB=function(){return!!i("indexedDB",a)},x.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},x.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},x.cssanimations=function(){return i("animationName")},x.csstransforms=function(){return!!i("transform")},x.csstransforms3d=function(){var a=!!i("perspective");return a&&"webkitPerspective"in p.style&&A("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},x.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(d){}return c},x.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(d){}return c},x.localstorage=function(){try{return localStorage.setItem(q,q),localStorage.removeItem(q),!0}catch(a){return!1}},x.sessionstorage=function(){try{return sessionStorage.setItem(q,q),sessionStorage.removeItem(q),!0}catch(a){return!1}},x.webworkers=function(){return!!a.Worker},x.applicationcache=function(){return!!a.applicationCache};for(var D in x)l(x,D)&&(k=D.toLowerCase(),n[k]=x[D](),y.push((n[k]?"":"no-")+k));return n.addTest=function(a,b){if("object"==typeof a)for(var d in a)l(a,d)&&n.addTest(d,a[d]);else{if(a=a.toLowerCase(),n[a]!==c)return n;b="function"==typeof b?b():b,"undefined"!=typeof o&&o&&(p.className+=" feat-"+(b?"":"no-")+a),n[a]=b}return n},d(""),r=j=null,n._version=m,n._prefixes=t,n._domPrefixes=w,n._cssomPrefixes=v,n.hasEvent=B,n.testProp=function(a){return g([a])},n.testAllProps=i,n.testStyles=A,n.prefixed=function(a,b,c){return b?i(a,b,c):i(a,"pfx")},p.className=p.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(o?" feat-js feat-"+y.join(" feat-"):""),n}(this,this.document),Modernizr.addTest("battery",!!Modernizr.prefixed("battery",navigator)),Modernizr.addTest("fullscreen",function(){for(var a=0;a<Modernizr._domPrefixes.length;a++)if(document[Modernizr._domPrefixes[a].toLowerCase()+"CancelFullScreen"])return!0;return!!document.cancelFullScreen||!1}),Modernizr.addTest("vibrate",!!Modernizr.prefixed("vibrate",navigator)),Modernizr.addTest("gamepads",!!Modernizr.prefixed("getGamepads",navigator)),window.JSON&&window.JSON.stringify||function(){function toJSON(){try{return this.valueOf()}catch(a){return null}}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&(i=toJSON.call(i,a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)d=rep[c],"string"==typeof d&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}window.JSON||(window.JSON={});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text){return eval("("+text+")")})}();var NOW=1,READY=!1,READY_BUFFER=[],PRESENCE_SUFFIX="-pnpres",DEF_WINDOWING=10,DEF_TIMEOUT=1e4,DEF_SUB_TIMEOUT=310,DEF_KEEPALIVE=60,SECOND=1e3,URLBIT="/",PARAMSBIT="&",REPL=/{([\w\-]+)}/g,nextorigin=function(){var a=20,b=Math.floor(Math.random()*a);return function(c,d){return c.indexOf("pubsub.")>0&&c.replace("pubsub","ps"+(d?uuid().split("-")[0]:++b<a?b:b=1))||c}}();window.PUBNUB||function(){function a(a){return document.getElementById(a)}function b(a){console.error(a)}function c(a,b){var c=[];return each(a.split(/\s+/),function(a){each((b||document).getElementsByTagName(a),function(a){c.push(a)})}),c}function d(a,b,c){each(a.split(","),function(a){var d=function(a){a||(a=window.event),c(a)||(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())};b.addEventListener?b.addEventListener(a,d,!1):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function e(){return c("head")[0]}function f(a,b,c){return c?(a.setAttribute(b,c),void 0):a&&a.getAttribute&&a.getAttribute(b)}function g(a,b){for(var c in b)if(b.hasOwnProperty(c))try{a.style[c]=b[c]+("|width|height|top|left|".indexOf(c)>0&&"number"==typeof b[c]?"px":"")}catch(d){}}function h(a){return document.createElement(a)}function i(){return r||m()?0:unique()}function j(b){if(r||m())return k(b);var c=h("script"),d=b.callback,g=unique(),i=0,j=b.timeout||DEF_TIMEOUT,l=timeout(function(){u(1)},j),n=b.fail||function(){},p=b.data||{},s=b.success||function(){},t=function(){e().appendChild(c)},u=function(b,d){i||(i=1,c.onerror=null,clearTimeout(l),b||!d||s(d),timeout(function(){b&&n();var c=a(g),d=c&&c.parentNode;d&&d.removeChild(c)},SECOND))};return window[d]=function(a){u(0,a)},b.blocking||(c[o]=o),c.onerror=function(){u(1)},p.pnsdk=q,c.src=build_url(b.url,p),f(c,"id",g),t(),u}function k(a){var b,c,d=function(){if(!f){f=1,clearTimeout(h);try{c=JSON.parse(b.responseText)}catch(a){return o(1)}e=1,l(c)}},e=0,f=0,g=a.timeout||DEF_TIMEOUT,h=timeout(function(){o(1)},g),i=a.fail||function(){},k=a.data||{},l=a.success||function(){},n="undefined"==typeof a.blocking,o=function(a){e||(e=1,clearTimeout(h),b&&(b.onerror=b.onload=null,b.abort&&b.abort(),b=null),a&&i())};try{b=m()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest,b.onerror=b.onabort=function(){o(1)},b.onload=b.onloadend=d,n&&(b.timeout=g),k.pnsdk=q;var p=build_url(a.url,k);b.open("GET",p,n),b.send()}catch(s){return o(0),r=0,j(a)}return o}function l(){return"onLine"in navigator?navigator.onLine:1}function m(){if(!x||!x.get)return 0;var a={id:m.id++,send:function(){},abort:function(){a.id={}},open:function(b,c){m[a.id]=a,x.get(a.id,c)}};return a}var n="https://pubnub.a.ssl.fastly.net/pubnub.swf",o="async",p=navigator.userAgent,q="PubNub-JS-Web/3.5.3.1",r=-1==p.indexOf("MSIE 6");window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||function(){});var s=function(){var a=window.localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?null:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||null}catch(c){return}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){return}}}}(),t={list:{},unbind:function(a){t.list[a]=[]},bind:function(a,b){(t.list[a]=t.list[a]||[]).push(b)},fire:function(a,b){each(t.list[a]||[],function(a){a(b)})}},u=a("pubnub")||0,v=function(k){k.jsonp&&(r=0);var m=k.subscribe_key||"";(+k.keepalive||DEF_KEEPALIVE)*SECOND,k.uuid||s.get(m+"uuid")||"",k.xdr=j,k.db=s,k.error=b,k._is_online=l,k.jsonp_cb=i;var n=PN_API(k);return n.css=g,n.$=a,n.create=h,n.bind=d,n.head=e,n.search=c,n.attr=f,n.events=t,n.init=v,d("beforeunload",window,function(){return n["each-channel"](function(a){n.LEAVE(a.name,0)}),!0}),k.notest?n:(d("offline",window,n.offline),d("offline",document,n.offline),n)};d("load",window,function(){timeout(ready,0)});var w=u||{};PUBNUB=v({notest:1,publish_key:f(w,"pub-key"),subscribe_key:f(w,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==f(w,"ssl"),origin:f(w,"origin"),uuid:f(w,"uuid")}),window.jQuery&&(window.jQuery.PUBNUB=PUBNUB),"undefined"!=typeof module&&(module.exports=PUBNUB)&&ready();var x=a("pubnubs")||0;u&&(g(u,{position:"absolute",top:-SECOND}),("opera"in window||f(u,"flash"))&&(u.innerHTML="<object id=pubnubs data="+n+"><param name=movie value="+n+"><param name=allowscriptaccess value=always></object>"),PUBNUB.rdx=function(a,b){return b?(m[a].responseText=unescape(b),m[a].onload(),void 0):m[a].onerror()},m.id=SECOND)}(),function(){var a=PUBNUB.ws=function(b,c){if(!(this instanceof a))return new a(b,c);var d=this,b=d.url=b||"",e=(d.protocol=c||"Sec-WebSocket-Protocol",b.split("/")),f={ssl:"wss:"===e[0],origin:e[2],publish_key:e[3],subscribe_key:e[4],channel:e[5]};return d.CONNECTING=0,d.OPEN=1,d.CLOSING=2,d.CLOSED=3,d.CLOSE_NORMAL=1e3,d.CLOSE_GOING_AWAY=1001,d.CLOSE_PROTOCOL_ERROR=1002,d.CLOSE_UNSUPPORTED=1003,d.CLOSE_TOO_LARGE=1004,d.CLOSE_NO_STATUS=1005,d.CLOSE_ABNORMAL=1006,d.onclose=d.onerror=d.onmessage=d.onopen=d.onsend=function(){},d.binaryType="",d.extensions="",d.bufferedAmount=0,d.trasnmitting=!1,d.buffer=[],d.readyState=d.CONNECTING,b?(d.pubnub=PUBNUB.init(f),d.pubnub.setup=f,d.setup=f,d.pubnub.subscribe({restore:!1,channel:f.channel,disconnect:d.onerror,reconnect:d.onopen,error:function(){d.onclose({code:d.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!1})},callback:function(a){d.onmessage({data:a})},connect:function(){d.readyState=d.OPEN,d.onopen()}}),void 0):(d.readyState=d.CLOSED,d.onclose({code:d.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),d)};a.prototype.send=function(a){var b=this;b.pubnub.publish({channel:b.pubnub.setup.channel,message:a,callback:function(a){b.onsend({data:a})}})},a.prototype.close=function(){var a=this;a.pubnub.unsubscribe({channel:a.pubnub.setup.channel}),a.readyState=a.CLOSED,a.onclose({})}}(),function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("bean",this,function(a,b){a=a||"bean",b=b||this;var c,d=window,e=b[a],f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="removeEventListener",j=document||{},k=j.documentElement||{},l=k[h],m=l?h:"attachEvent",n={},o=Array.prototype.slice,p=function(a,b){return a.split(b||" ")},q=function(a){return"string"==typeof a},r=function(a){return"function"==typeof a},s="click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange message error abort scroll ",t="show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend textinputreadystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ",u=function(a,b,c){for(c=0;c<b.length;c++)b[c]&&(a[b[c]]=1);return a}({},p(s+(l?t:""))),v=function(){var a="compareDocumentPosition"in k?function(a,b){return b.compareDocumentPosition&&16===(16&b.compareDocumentPosition(a))}:"contains"in k?function(a,b){return b=9===b.nodeType||b===window?k:b,b!==a&&b.contains(a)}:function(a,b){for(;a=a.parentNode;)if(a===b)return 1;return 0},b=function(b){var c=b.relatedTarget;return c?c!==this&&"xul"!==c.prefix&&!/document/.test(this.toString())&&!a(c,this):null==c};return{mouseenter:{base:"mouseover",condition:b},mouseleave:{base:"mouseout",condition:b},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),w=function(){var a=p("altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which propertyName"),b=a.concat(p("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement")),c=b.concat(p("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis")),e=a.concat(p("char charCode key keyCode keyIdentifier keyLocation location")),f=a.concat(p("data")),g=a.concat(p("touches targetTouches changedTouches scale rotation")),h=a.concat(p("data origin source")),i=a.concat(p("state")),l=/over|out/,m=[{reg:/key/i,fix:function(a,b){return b.keyCode=a.keyCode||a.which,e}},{reg:/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,fix:function(a,c,d){return c.rightClick=3===a.which||2===a.button,c.pos={x:0,y:0},a.pageX||a.pageY?(c.clientX=a.pageX,c.clientY=a.pageY):(a.clientX||a.clientY)&&(c.clientX=a.clientX+j.body.scrollLeft+k.scrollLeft,c.clientY=a.clientY+j.body.scrollTop+k.scrollTop),l.test(d)&&(c.relatedTarget=a.relatedTarget||a[("mouseover"==d?"from":"to")+"Element"]),b}},{reg:/mouse.*(wheel|scroll)/i,fix:function(){return c}},{reg:/^text/i,fix:function(){return f}},{reg:/^touch|^gesture/i,fix:function(){return g}},{reg:/^message$/i,fix:function(){return h}},{reg:/^popstate$/i,fix:function(){return i}},{reg:/.*/,fix:function(){return a}}],n={},o=function(a,b,c){if(arguments.length&&(a=a||((b.ownerDocument||b.document||b).parentWindow||d).event,this.originalEvent=a,this.isNative=c,this.isBean=!0,a)){var e,f,g,h,i,j=a.type,k=a.target||a.srcElement;if(this.target=k&&3===k.nodeType?k.parentNode:k,c){if(i=n[j],!i)for(e=0,f=m.length;f>e;e++)if(m[e].reg.test(j)){n[j]=i=m[e].fix;break}for(h=i(a,this,j),e=h.length;e--;)!((g=h[e])in this)&&g in a&&(this[g]=a[g])}}};return o.prototype.preventDefault=function(){this.originalEvent.preventDefault?this.originalEvent.preventDefault():this.originalEvent.returnValue=!1},o.prototype.stopPropagation=function(){this.originalEvent.stopPropagation?this.originalEvent.stopPropagation():this.originalEvent.cancelBubble=!0},o.prototype.stop=function(){this.preventDefault(),this.stopPropagation(),this.stopped=!0},o.prototype.stopImmediatePropagation=function(){this.originalEvent.stopImmediatePropagation&&this.originalEvent.stopImmediatePropagation(),this.isImmediatePropagationStopped=function(){return!0}},o.prototype.isImmediatePropagationStopped=function(){return this.originalEvent.isImmediatePropagationStopped&&this.originalEvent.isImmediatePropagationStopped()},o.prototype.clone=function(a){var b=new o(this,this.element,this.isNative);return b.currentTarget=a,b},o}(),x=function(a,b){return l||b||a!==j&&a!==d?a:k},y=function(){var a=function(a,b,c,d){var e=function(c,e){return b.apply(a,d?o.call(e,c?0:1).concat(d):e)},f=function(c,d){return b.__beanDel?b.__beanDel.ft(c.target,a):d},g=c?function(a){var b=f(a,this);return c.apply(b,arguments)?(a&&(a.currentTarget=b),e(a,arguments)):void 0}:function(a){return b.__beanDel&&(a=a.clone(f(a))),e(a,arguments)};return g.__beanDel=b.__beanDel,g},b=function(b,c,d,e,f,g,h){var i,j=v[c];"unload"==c&&(d=D(E,b,c,d,e)),j&&(j.condition&&(d=a(b,d,j.condition,g)),c=j.base||c),this.isNative=i=u[c]&&!!b[m],this.customType=!l&&!i&&c,this.element=b,this.type=c,this.original=e,this.namespaces=f,this.eventType=l||i?c:"propertychange",this.target=x(b,i),this[m]=!!this.target[m],this.root=h,this.handler=a(b,d,null,g)};return b.prototype.inNamespaces=function(a){var b,c,d=0;if(!a)return!0;if(!this.namespaces)return!1;for(b=a.length;b--;)for(c=this.namespaces.length;c--;)a[b]==this.namespaces[c]&&d++;return a.length===d},b.prototype.matches=function(a,b,c){return!(this.element!==a||b&&this.original!==b||c&&this.handler!==c)},b}(),z=function(){var a={},b=function(c,d,e,f,g,h){var i=g?"r":"$";if(d&&"*"!=d){var j,k=0,l=a[i+d],m="*"==c;if(!l)return;for(j=l.length;j>k;k++)if((m||l[k].matches(c,e,f))&&!h(l[k],l,k,d))return}else for(var n in a)n.charAt(0)==i&&b(c,n.substr(1),e,f,g,h)},c=function(b,c,d,e){var f,g=a[(e?"r":"$")+c];if(g)for(f=g.length;f--;)if(!g[f].root&&g[f].matches(b,d,null))return!0;return!1},d=function(a,c,d,e){var f=[];return b(a,c,d,null,e,function(a){return f.push(a)}),f},e=function(b){var c=!b.root&&!this.has(b.element,b.type,null,!1),d=(b.root?"r":"$")+b.type;return(a[d]||(a[d]=[])).push(b),c},f=function(c){b(c.element,c.type,null,c.handler,c.root,function(b,c,d){return c.splice(d,1),b.removed=!0,0===c.length&&delete a[(b.root?"r":"$")+b.type],!1})},g=function(){var b,c=[];for(b in a)"$"==b.charAt(0)&&(c=c.concat(a[b]));return c};return{has:c,get:d,put:e,del:f,entries:g}}(),A=function(a){c=arguments.length?a:j.querySelectorAll?function(a,b){return b.querySelectorAll(a)}:function(){throw new Error("Bean: No selector engine installed")}},B=function(a,b){if(l||!b||!a||a.propertyName=="_on"+b){var c=z.get(this,b||a.type,null,!1),d=c.length,e=0;for(a=new w(a,this,!0),b&&(a.type=b);d>e&&!a.isImmediatePropagationStopped();e++)c[e].removed||c[e].handler.call(this,a)}},C=l?function(a,b,c){a[c?h:i](b,B,!1)}:function(a,b,c,d){var e;c?(z.put(e=new y(a,d||b,function(b){B.call(a,b,d)},B,null,null,!0)),d&&null==a["_on"+d]&&(a["_on"+d]=0),e.target.attachEvent("on"+e.eventType,e.handler)):(e=z.get(a,d||b,B,!0)[0],e&&(e.target.detachEvent("on"+e.eventType,e.handler),z.del(e)))},D=function(a,b,c,d,e){return function(){d.apply(this,arguments),a(b,c,e)}},E=function(a,b,c,d){var e,f,h=b&&b.replace(g,""),i=z.get(a,h,null,!1),j={};for(e=0,f=i.length;f>e;e++)c&&i[e].original!==c||!i[e].inNamespaces(d)||(z.del(i[e]),!j[i[e].eventType]&&i[e][m]&&(j[i[e].eventType]={t:i[e].eventType,c:i[e].type}));for(e in j)z.has(a,j[e].t,null,!1)||C(a,j[e].t,!1,j[e].c)},F=function(a,b){var d=function(b,d){for(var e,f=q(a)?c(a,d):a;b&&b!==d;b=b.parentNode)for(e=f.length;e--;)if(f[e]===b)return b},e=function(a){var c=d(a.target,this);c&&b.apply(c,arguments)};return e.__beanDel={ft:d,selector:a},e},G=l?function(a,b,c){var e=j.createEvent(a?"HTMLEvents":"UIEvents");e[a?"initEvent":"initUIEvent"](b,!0,!0,d,1),c.dispatchEvent(e)}:function(a,b,c){c=x(c,a),a?c.fireEvent("on"+b,j.createEventObject()):c["_on"+b]++},H=function(a,b,c){var d,e,h,i,j=q(b);if(j&&b.indexOf(" ")>0){for(b=p(b),i=b.length;i--;)H(a,b[i],c);return a}if(e=j&&b.replace(g,""),e&&v[e]&&(e=v[e].base),!b||j)(h=j&&b.replace(f,""))&&(h=p(h,".")),E(a,e,c,h);else if(r(b))E(a,null,b);else for(d in b)b.hasOwnProperty(d)&&H(a,d,b[d]);return a},I=function(a,b,d,e){var h,i,j,k,l,q,s;{if(void 0!==d||"object"!=typeof b){for(r(d)?(l=o.call(arguments,3),e=h=d):(h=e,l=o.call(arguments,4),e=F(d,h,c)),j=p(b),this===n&&(e=D(H,a,b,e,h)),k=j.length;k--;)s=z.put(q=new y(a,j[k].replace(g,""),e,h,p(j[k].replace(f,""),"."),l,!1)),q[m]&&s&&C(a,q.eventType,!0,q.customType);return a}for(i in b)b.hasOwnProperty(i)&&I.call(this,a,i,b[i])}},J=function(a,b,c,d){return I.apply(null,q(c)?[a,c,b,d].concat(arguments.length>3?o.call(arguments,5):[]):o.call(arguments))},K=function(){return I.apply(n,arguments)},L=function(a,b,c){var d,e,h,i,j,k=p(b);for(d=k.length;d--;)if(b=k[d].replace(g,""),(i=k[d].replace(f,""))&&(i=p(i,".")),i||c||!a[m])for(j=z.get(a,b,null,!1),c=[!1].concat(c),e=0,h=j.length;h>e;e++)j[e].inNamespaces(i)&&j[e].handler.apply(a,c);else G(u[b],b,a);return a},M=function(a,b,c){for(var d,e,f=z.get(b,c,null,!1),g=f.length,h=0;g>h;h++)f[h].original&&(d=[a,f[h].type],(e=f[h].handler.__beanDel)&&d.push(e.selector),d.push(f[h].original),I.apply(null,d));return a},N={on:I,add:J,one:K,off:H,remove:H,clone:M,fire:L,Event:w,setSelectorEngine:A,noConflict:function(){return b[a]=e,this}};if(d.attachEvent){var O=function(){var a,b=z.entries();for(a in b)b[a].type&&"unload"!==b[a].type&&H(b[a].element,b[a].type);d.detachEvent("onunload",O),d.CollectGarbage&&d.CollectGarbage()};d.attachEvent("onunload",O)}return A(),N}),function(a,b){"use strict";function c(){d.READY||(d.event.determineEventTypes(),d.utils.each(d.gestures,function(a){d.detection.register(a)}),d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect),d.event.onTouch(d.DOCUMENT,d.EVENT_END,d.detection.detect),d.READY=!0)}var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},d.HAS_POINTEREVENTS=a.navigator.pointerEnabled||a.navigator.msPointerEnabled,d.HAS_TOUCHEVENTS="ontouchstart"in a,d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&a.navigator.userAgent.match(d.MOBILE_REGEX),d.EVENT_TYPES={},d.DIRECTION_DOWN="down",d.DIRECTION_LEFT="left",d.DIRECTION_UP="up",d.DIRECTION_RIGHT="right",d.POINTER_MOUSE="mouse",d.POINTER_TOUCH="touch",d.POINTER_PEN="pen",d.EVENT_START="start",d.EVENT_MOVE="move",d.EVENT_END="end",d.DOCUMENT=a.document,d.plugins=d.plugins||{},d.gestures=d.gestures||{},d.READY=!1,d.utils={extend:function(a,c,d){for(var e in c)a[e]!==b&&d||(a[e]=c[e]);
return a},each:function(a,c,d){var e,f;if("forEach"in a)a.forEach(c,d);else if(a.length!==b){for(e=0,f=a.length;f>e;e++)if(c.call(d,a[e],e,a)===!1)return}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){var b=[],c=[];return d.utils.each(a,function(a){b.push("undefined"!=typeof a.clientX?a.clientX:a.pageX),c.push("undefined"!=typeof a.clientY?a.clientY:a.pageY)}),{pageX:(Math.min.apply(Math,b)+Math.max.apply(Math,b))/2,pageY:(Math.min.apply(Math,c)+Math.max.apply(Math,c))/2}},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.pageY-a.pageY,d=b.pageX-a.pageX;return 180*Math.atan2(c,d)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.pageX-b.pageX),e=Math.abs(a.pageY-b.pageY);return c>=e?a.pageX-b.pageX>0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:a.pageY-b.pageY>0?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var c=b.pageX-a.pageX,d=b.pageY-a.pageY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,b){b&&a&&a.style&&(d.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(c){d.utils.each(b,function(b){c&&(b=c+b.substring(0,1).toUpperCase()+b.substring(1)),b in a.style&&(a.style[b]=b)})}),"none"==b.userSelect&&(a.onselectstart=function(){return!1}),"none"==b.userDrag&&(a.ondragstart=function(){return!1}))}},d.Instance=function(a,b){var e=this;return c(),this.element=a,this.enabled=!0,this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{}),this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)}),this},d.Instance.prototype={on:function(a,b){var c=a.split(" ");return d.utils.each(c,function(a){this.element.addEventListener(a,b,!1)},this),this},off:function(a,b){var c=a.split(" ");return d.utils.each(c,function(a){this.element.removeEventListener(a,b,!1)},this),this},trigger:function(a,b){b||(b={});var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var e=this.element;return d.utils.hasParent(b.target,e)&&(e=b.target),e.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,c){var e=b.split(" ");d.utils.each(e,function(b){a.addEventListener(b,c,!1)})},onTouch:function(a,b,c){var h=this;this.bindDom(a,d.EVENT_TYPES[b],function(i){var j=i.type.toLowerCase();if(!j.match(/mouse/)||!g){j.match(/touch/)||j.match(/pointerdown/)||j.match(/mouse/)&&1===i.which?f=!0:j.match(/mouse/)&&!i.which&&(f=!1),j.match(/touch|pointer/)&&(g=!0);var k=0;f&&(d.HAS_POINTEREVENTS&&b!=d.EVENT_END?k=d.PointerEvent.updatePointer(b,i):j.match(/touch/)?k=i.touches.length:g||(k=j.match(/up/)?0:1),k>0&&b==d.EVENT_END?b=d.EVENT_MOVE:k||(b=d.EVENT_END),(k||null===e)&&(e=i),c.call(d.detection,h.collectEventData(a,b,h.getTouchList(e,b),i)),d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(k=d.PointerEvent.updatePointer(b,i))),k||(e=null,f=!1,g=!1,d.PointerEvent.reset())}})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],d.EVENT_TYPES[d.EVENT_START]=a[0],d.EVENT_TYPES[d.EVENT_MOVE]=a[1],d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){return d.HAS_POINTEREVENTS?d.PointerEvent.getTouchList():a.touches?a.touches:(a.identifier=1,[a])},collectEventData:function(a,b,c,e){var f=d.POINTER_TOUCH;return(e.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,e))&&(f=d.POINTER_MOUSE),{center:d.utils.getCenter(c),timeStamp:(new Date).getTime(),target:e.target,touches:c,eventType:b,pointerType:f,srcEvent:e,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return d.detection.stopDetect()}}}},d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];return d.utils.each(a.pointers,function(a){b.push(a)}),b},updatePointer:function(a,b){return a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b),Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var c=b.pointerType,e={};return e[d.POINTER_MOUSE]=c===b.MSPOINTER_TYPE_MOUSE||c===d.POINTER_MOUSE,e[d.POINTER_TOUCH]=c===b.MSPOINTER_TYPE_TOUCH||c===d.POINTER_TOUCH,e[d.POINTER_PEN]=c===b.MSPOINTER_TYPE_PEN||c===d.POINTER_PEN,e[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);var b=this.current.inst.options;return d.utils.each(this.gestures,function(c){return this.stopped||b[c.name]===!1||c.handler.call(c,a,this.current.inst)!==!1?void 0:(this.stopDetect(),!1)},this),this.current&&(this.current.lastEvent=a),a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect(),a}},stopDetect:function(){this.previous=d.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;!b||a.touches.length==b.touches.length&&a.touches!==b.touches||(b.touches=[],d.utils.each(a.touches,function(a){b.touches.push(d.utils.extend({},a))}));var c,e,f=a.timeStamp-b.timeStamp,g=a.center.pageX-b.center.pageX,h=a.center.pageY-b.center.pageY,i=d.utils.getVelocity(f,g,h);return"end"===a.eventType?(c=this.current.lastEvent&&this.current.lastEvent.interimAngle,e=this.current.lastEvent&&this.current.lastEvent.interimDirection):(c=this.current.lastEvent&&d.utils.getAngle(this.current.lastEvent.center,a.center),e=this.current.lastEvent&&d.utils.getDirection(this.current.lastEvent.center,a.center)),d.utils.extend(a,{deltaTime:f,deltaX:g,deltaY:h,velocityX:i.x,velocityY:i.y,distance:d.utils.getDistance(b.center,a.center),angle:d.utils.getAngle(b.center,a.center),interimAngle:c,direction:d.utils.getDirection(b.center,a.center),interimDirection:e,scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),startEvent:b}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),d.utils.extend(d.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),this.triggered=!1,void 0;if(!(b.options.drag_max_touches>0&&a.touches.length>b.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<b.options.drag_min_distance&&d.detection.current.name!=this.name)return;if(d.detection.current.name!=this.name&&(d.detection.current.name=this.name,b.options.correct_for_drag_min_distance&&a.distance>0)){var c=Math.abs(b.options.drag_min_distance/a.distance);d.detection.current.startEvent.center.pageX+=a.deltaX*c,d.detection.current.startEvent.center.pageY+=a.deltaY*c,a=d.detection.extendEventData(a)}(d.detection.current.lastEvent.drag_locked_to_axis||b.options.drag_lock_to_axis&&b.options.drag_lock_min_distance<=a.distance)&&(a.drag_locked_to_axis=!0);var e=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&e!==a.direction&&(a.direction=d.utils.isVertical(e)?a.deltaY<0?d.DIRECTION_UP:d.DIRECTION_DOWN:a.deltaX<0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT),this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),b.trigger(this.name+a.direction,a),(b.options.drag_block_vertical&&d.utils.isVertical(a.direction)||b.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer),d.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}},d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,a)}},d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(a,b){if(a.eventType==d.EVENT_END){if(b.options.swipe_max_touches>0&&a.touches.length<b.options.swipe_min_touches&&a.touches.length>b.options.swipe_max_touches)return;(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END&&"touchcancel"!=a.srcEvent.type){var c=d.detection.previous,e=!1;if(a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance)return;c&&"tap"==c.name&&a.timeStamp-c.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance&&(b.trigger("doubletap",a),e=!0),(!e||b.options.tap_always)&&(d.detection.current.name="tap",b.trigger(d.detection.current.name,a))}}},d.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,b){return b.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?(a.stopDetect(),void 0):(b.options.prevent_default&&a.preventDefault(),a.eventType==d.EVENT_START&&b.trigger(this.name,a),void 0)}},d.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),this.triggered=!1,void 0;if(!(a.touches.length<2))switch(b.options.transform_always_block&&a.preventDefault(),a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var c=Math.abs(1-a.scale),e=Math.abs(a.rotation);if(c<b.options.transform_min_scale&&e<b.options.transform_min_rotation)return;d.detection.current.name=this.name,this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),e>b.options.transform_min_rotation&&b.trigger("rotate",a),c>b.options.transform_min_scale&&(b.trigger("pinch",a),b.trigger("pinch"+(a.scale<1?"in":"out"),a));break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return d}):"object"==typeof module&&"object"==typeof module.exports?module.exports=d:a.Hammer=d}(this);var Sylvester={version:"0.1.3",precision:1e-6};Vector.prototype={e:function(a){return 1>a||a>this.elements.length?null:this.elements[a-1]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(a){var b=this.elements.length,c=a.elements||a;if(b!=c.length)return!1;do if(Math.abs(this.elements[b-1]-c[b-1])>Sylvester.precision)return!1;while(--b);return!0},dup:function(){return Vector.create(this.elements)},map:function(a){var b=[];return this.each(function(c,d){b.push(a(c,d))}),Vector.create(b)},each:function(a){var b,c=this.elements.length,d=c;do b=d-c,a(this.elements[b],b+1);while(--c)},toUnitVector:function(){var a=this.modulus();return 0===a?this.dup():this.map(function(b){return b/a})},angleFrom:function(a){var b=a.elements||a,c=this.elements.length;if(c!=b.length)return null;var d=0,e=0,f=0;if(this.each(function(a,c){d+=a*b[c-1],e+=a*a,f+=b[c-1]*b[c-1]}),e=Math.sqrt(e),f=Math.sqrt(f),0===e*f)return null;var g=d/(e*f);return-1>g&&(g=-1),g>1&&(g=1),Math.acos(g)},isParallelTo:function(a){var b=this.angleFrom(a);return null===b?null:b<=Sylvester.precision},isAntiparallelTo:function(a){var b=this.angleFrom(a);return null===b?null:Math.abs(b-Math.PI)<=Sylvester.precision},isPerpendicularTo:function(a){var b=this.dot(a);return null===b?null:Math.abs(b)<=Sylvester.precision},add:function(a){var b=a.elements||a;return this.elements.length!=b.length?null:this.map(function(a,c){return a+b[c-1]})},subtract:function(a){var b=a.elements||a;return this.elements.length!=b.length?null:this.map(function(a,c){return a-b[c-1]})},multiply:function(a){return this.map(function(b){return b*a})},x:function(a){return this.multiply(a)},dot:function(a){var b=a.elements||a,c=0,d=this.elements.length;if(d!=b.length)return null;do c+=this.elements[d-1]*b[d-1];while(--d);return c},cross:function(a){var b=a.elements||a;if(3!=this.elements.length||3!=b.length)return null;var c=this.elements;return Vector.create([c[1]*b[2]-c[2]*b[1],c[2]*b[0]-c[0]*b[2],c[0]*b[1]-c[1]*b[0]])},max:function(){var a,b=0,c=this.elements.length,d=c;do a=d-c,Math.abs(this.elements[a])>Math.abs(b)&&(b=this.elements[a]);while(--c);return b},indexOf:function(a){var b,c=null,d=this.elements.length,e=d;do b=e-d,null===c&&this.elements[b]==a&&(c=b+1);while(--d);return c},toDiagonalMatrix:function(){return Matrix.Diagonal(this.elements)},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=Sylvester.precision?a:b})},distanceFrom:function(a){if(a.anchor)return a.distanceFrom(this);var b=a.elements||a;if(b.length!=this.elements.length)return null;var c,d=0;return this.each(function(a,e){c=a-b[e-1],d+=c*c}),Math.sqrt(d)},liesOn:function(a){return a.contains(this)},liesIn:function(a){return a.contains(this)},rotate:function(a,b){var c,d,e,f,g;switch(this.elements.length){case 2:return c=b.elements||b,2!=c.length?null:(d=Matrix.Rotation(a).elements,e=this.elements[0]-c[0],f=this.elements[1]-c[1],Vector.create([c[0]+d[0][0]*e+d[0][1]*f,c[1]+d[1][0]*e+d[1][1]*f]));case 3:if(!b.direction)return null;var h=b.pointClosestTo(this).elements;return d=Matrix.Rotation(a,b.direction).elements,e=this.elements[0]-h[0],f=this.elements[1]-h[1],g=this.elements[2]-h[2],Vector.create([h[0]+d[0][0]*e+d[0][1]*f+d[0][2]*g,h[1]+d[1][0]*e+d[1][1]*f+d[1][2]*g,h[2]+d[2][0]*e+d[2][1]*f+d[2][2]*g]);default:return null}},reflectionIn:function(a){if(a.anchor){var b=this.elements.slice(),c=a.pointClosestTo(b).elements;return Vector.create([c[0]+(c[0]-b[0]),c[1]+(c[1]-b[1]),c[2]+(c[2]-(b[2]||0))])}var d=a.elements||a;return this.elements.length!=d.length?null:this.map(function(a,b){return d[b-1]+(d[b-1]-a)})},to3D:function(){var a=this.dup();switch(a.elements.length){case 3:break;case 2:a.elements.push(0);break;default:return null}return a},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(a){return this.elements=(a.elements||a).slice(),this}},Vector.create=function(a){var b=new Vector;return b.setElements(a)},Vector.i=Vector.create([1,0,0]),Vector.j=Vector.create([0,1,0]),Vector.k=Vector.create([0,0,1]),Vector.Random=function(a){var b=[];do b.push(Math.random());while(--a);return Vector.create(b)},Vector.Zero=function(a){var b=[];do b.push(0);while(--a);return Vector.create(b)},Matrix.prototype={e:function(a,b){return 1>a||a>this.elements.length||1>b||b>this.elements[0].length?null:this.elements[a-1][b-1]},row:function(a){return a>this.elements.length?null:Vector.create(this.elements[a-1])},col:function(a){if(a>this.elements[0].length)return null;var b,c=[],d=this.elements.length,e=d;do b=e-d,c.push(this.elements[b][a-1]);while(--d);return Vector.create(c)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(a){var b=a.elements||a;if("undefined"==typeof b[0][0]&&(b=Matrix.create(b).elements),this.elements.length!=b.length||this.elements[0].length!=b[0].length)return!1;var c,d,e,f=this.elements.length,g=f,h=this.elements[0].length;do{c=g-f,d=h;do if(e=h-d,Math.abs(this.elements[c][e]-b[c][e])>Sylvester.precision)return!1;while(--d)}while(--f);return!0},dup:function(){return Matrix.create(this.elements)},map:function(a){var b,c,d,e=[],f=this.elements.length,g=f,h=this.elements[0].length;do{b=g-f,c=h,e[b]=[];do d=h-c,e[b][d]=a(this.elements[b][d],b+1,d+1);while(--c)}while(--f);return Matrix.create(e)},isSameSizeAs:function(a){var b=a.elements||a;return"undefined"==typeof b[0][0]&&(b=Matrix.create(b).elements),this.elements.length==b.length&&this.elements[0].length==b[0].length},add:function(a){var b=a.elements||a;return"undefined"==typeof b[0][0]&&(b=Matrix.create(b).elements),this.isSameSizeAs(b)?this.map(function(a,c,d){return a+b[c-1][d-1]}):null},subtract:function(a){var b=a.elements||a;return"undefined"==typeof b[0][0]&&(b=Matrix.create(b).elements),this.isSameSizeAs(b)?this.map(function(a,c,d){return a-b[c-1][d-1]}):null},canMultiplyFromLeft:function(a){var b=a.elements||a;return"undefined"==typeof b[0][0]&&(b=Matrix.create(b).elements),this.elements[0].length==b.length},multiply:function(a){if(!a.elements)return this.map(function(b){return b*a});var b=a.modulus?!0:!1,c=a.elements||a;if("undefined"==typeof c[0][0]&&(c=Matrix.create(c).elements),!this.canMultiplyFromLeft(c))return null;var d,e,f,g,h,i,j=this.elements.length,k=j,l=c[0].length,m=this.elements[0].length,n=[];do{d=k-j,n[d]=[],e=l;do{f=l-e,g=0,h=m;do i=m-h,g+=this.elements[d][i]*c[i][f];while(--h);n[d][f]=g}while(--e)}while(--j);var c=Matrix.create(n);return b?c.col(1):c},x:function(a){return this.multiply(a)},minor:function(a,b,c,d){var e,f,g,h=[],i=c,j=this.elements.length,k=this.elements[0].length;do{e=c-i,h[e]=[],f=d;do g=d-f,h[e][g]=this.elements[(a+e-1)%j][(b+g-1)%k];while(--f)}while(--i);return Matrix.create(h)},transpose:function(){var a,b,c,d=this.elements.length,e=this.elements[0].length,f=[],g=e;do{a=e-g,f[a]=[],b=d;do c=d-b,f[a][c]=this.elements[c][a];while(--b)}while(--g);return Matrix.create(f)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){var a,b,c,d=0,e=this.elements.length,f=e,g=this.elements[0].length;do{a=f-e,b=g;do c=g-b,Math.abs(this.elements[a][c])>Math.abs(d)&&(d=this.elements[a][c]);while(--b)}while(--e);return d},indexOf:function(a){var b,c,d,e=this.elements.length,f=e,g=this.elements[0].length;do{b=f-e,c=g;do if(d=g-c,this.elements[b][d]==a)return{i:b+1,j:d+1};while(--c)}while(--e);return null},diagonal:function(){if(!this.isSquare)return null;var a,b=[],c=this.elements.length,d=c;do a=d-c,b.push(this.elements[a][a]);while(--c);return Vector.create(b)},toRightTriangular:function(){var a,b,c,d,e=this.dup(),f=this.elements.length,g=f,h=this.elements[0].length;do{if(b=g-f,0==e.elements[b][b])for(j=b+1;g>j;j++)if(0!=e.elements[j][b]){a=[],c=h;do d=h-c,a.push(e.elements[b][d]+e.elements[j][d]);while(--c);e.elements[b]=a;break}if(0!=e.elements[b][b])for(j=b+1;g>j;j++){var i=e.elements[j][b]/e.elements[b][b];a=[],c=h;do d=h-c,a.push(b>=d?0:e.elements[j][d]-e.elements[b][d]*i);while(--c);e.elements[j]=a}}while(--f);return e},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;var a,b=this.toRightTriangular(),c=b.elements[0][0],d=b.elements.length-1,e=d;do a=e-d+1,c*=b.elements[a][a];while(--d);return c},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;var a,b=this.elements[0][0],c=this.elements.length-1,d=c;do a=d-c+1,b+=this.elements[a][a];while(--c);return b},tr:function(){return this.trace()},rank:function(){var a,b,c,d=this.toRightTriangular(),e=0,f=this.elements.length,g=f,h=this.elements[0].length;do{a=g-f,b=h;do if(c=h-b,Math.abs(d.elements[a][c])>Sylvester.precision){e++;break}while(--b)}while(--f);return e},rk:function(){return this.rank()},augment:function(a){var b=a.elements||a;"undefined"==typeof b[0][0]&&(b=Matrix.create(b).elements);var c,d,e,f=this.dup(),g=f.elements[0].length,h=f.elements.length,i=h,j=b[0].length;if(h!=b.length)return null;do{c=i-h,d=j;do e=j-d,f.elements[c][g+e]=b[c][e];while(--d)}while(--h);return f},inverse:function(){if(!this.isSquare()||this.isSingular())return null;var a,b,c,d,e,f,g,h=this.elements.length,i=h,j=this.augment(Matrix.I(h)).toRightTriangular(),k=j.elements[0].length,l=[];do{a=h-1,e=[],c=k,l[a]=[],f=j.elements[a][a];do d=k-c,g=j.elements[a][d]/f,e.push(g),d>=i&&l[a].push(g);while(--c);for(j.elements[a]=e,b=0;a>b;b++){e=[],c=k;do d=k-c,e.push(j.elements[b][d]-j.elements[a][d]*j.elements[b][a]);while(--c);j.elements[b]=e}}while(--h);return Matrix.create(l)},inv:function(){return this.inverse()},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=Sylvester.precision?a:b})},inspect:function(){var a,b=[],c=this.elements.length,d=c;do a=d-c,b.push(Vector.create(this.elements[a]).inspect());while(--c);return b.join("\n")},setElements:function(a){var b,c=a.elements||a;if("undefined"!=typeof c[0][0]){var d,e,f,g=c.length,h=g;this.elements=[];do{b=h-g,d=c[b].length,e=d,this.elements[b]=[];do f=e-d,this.elements[b][f]=c[b][f];while(--d)}while(--g);return this}var i=c.length,j=i;this.elements=[];do b=j-i,this.elements.push([c[b]]);while(--i);return this}},Matrix.create=function(a){var b=new Matrix;return b.setElements(a)},Matrix.I=function(a){var b,c,d,e=[],f=a;do{b=f-a,e[b]=[],c=f;do d=f-c,e[b][d]=b==d?1:0;while(--c)}while(--a);return Matrix.create(e)},Matrix.Diagonal=function(a){var b,c=a.length,d=c,e=Matrix.I(c);do b=d-c,e.elements[b][b]=a[b];while(--c);return e},Matrix.Rotation=function(a,b){if(!b)return Matrix.create([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]]);var c=b.dup();if(3!=c.elements.length)return null;var d=c.modulus(),e=c.elements[0]/d,f=c.elements[1]/d,g=c.elements[2]/d,h=Math.sin(a),i=Math.cos(a),j=1-i;return Matrix.create([[j*e*e+i,j*e*f-h*g,j*e*g+h*f],[j*e*f+h*g,j*f*f+i,j*f*g-h*e],[j*e*g-h*f,j*f*g+h*e,j*g*g+i]])},Matrix.RotationX=function(a){var b=Math.cos(a),c=Math.sin(a);return Matrix.create([[1,0,0],[0,b,-c],[0,c,b]])},Matrix.RotationY=function(a){var b=Math.cos(a),c=Math.sin(a);return Matrix.create([[b,0,c],[0,1,0],[-c,0,b]])},Matrix.RotationZ=function(a){var b=Math.cos(a),c=Math.sin(a);return Matrix.create([[b,-c,0],[c,b,0],[0,0,1]])},Matrix.Random=function(a,b){return Matrix.Zero(a,b).map(function(){return Math.random()})},Matrix.Zero=function(a,b){var c,d,e,f=[],g=a;do{c=a-g,f[c]=[],d=b;do e=b-d,f[c][e]=0;while(--d)}while(--g);return Matrix.create(f)},Line.prototype={eql:function(a){return this.isParallelTo(a)&&this.contains(a.anchor)},dup:function(){return Line.create(this.anchor,this.direction)},translate:function(a){var b=a.elements||a;return Line.create([this.anchor.elements[0]+b[0],this.anchor.elements[1]+b[1],this.anchor.elements[2]+(b[2]||0)],this.direction)},isParallelTo:function(a){if(a.normal)return a.isParallelTo(this);var b=this.direction.angleFrom(a.direction);return Math.abs(b)<=Sylvester.precision||Math.abs(b-Math.PI)<=Sylvester.precision},distanceFrom:function(a){if(a.normal)return a.distanceFrom(this);if(a.direction){if(this.isParallelTo(a))return this.distanceFrom(a.anchor);var b=this.direction.cross(a.direction).toUnitVector().elements,c=this.anchor.elements,d=a.anchor.elements;return Math.abs((c[0]-d[0])*b[0]+(c[1]-d[1])*b[1]+(c[2]-d[2])*b[2])}var e=a.elements||a,c=this.anchor.elements,f=this.direction.elements,g=e[0]-c[0],h=e[1]-c[1],i=(e[2]||0)-c[2],j=Math.sqrt(g*g+h*h+i*i);if(0===j)return 0;var k=(g*f[0]+h*f[1]+i*f[2])/j,l=1-k*k;return Math.abs(j*Math.sqrt(0>l?0:l))},contains:function(a){var b=this.distanceFrom(a);return null!==b&&b<=Sylvester.precision},liesIn:function(a){return a.contains(this)},intersects:function(a){return a.normal?a.intersects(this):!this.isParallelTo(a)&&this.distanceFrom(a)<=Sylvester.precision},intersectionWith:function(a){if(a.normal)return a.intersectionWith(this);if(!this.intersects(a))return null;var b=this.anchor.elements,c=this.direction.elements,d=a.anchor.elements,e=a.direction.elements,f=c[0],g=c[1],h=c[2],i=e[0],j=e[1],k=e[2],l=b[0]-d[0],m=b[1]-d[1],n=b[2]-d[2],o=-f*l-g*m-h*n,p=i*l+j*m+k*n,q=f*f+g*g+h*h,r=i*i+j*j+k*k,s=f*i+g*j+h*k,t=(o*r/q+s*p)/(r-s*s);return Vector.create([b[0]+t*f,b[1]+t*g,b[2]+t*h])},pointClosestTo:function(a){if(a.direction){if(this.intersects(a))return this.intersectionWith(a);if(this.isParallelTo(a))return null;var b=this.direction.elements,c=a.direction.elements,d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=f*g-d*i,k=d*h-e*g,l=e*i-f*h,m=Vector.create([j*i-k*h,k*g-l*i,l*h-j*g]),n=Plane.create(a.anchor,m);return n.intersectionWith(this)}var n=a.elements||a;if(this.contains(n))return Vector.create(n);var o=this.anchor.elements,b=this.direction.elements,d=b[0],e=b[1],f=b[2],p=o[0],q=o[1],r=o[2],j=d*(n[1]-q)-e*(n[0]-p),k=e*((n[2]||0)-r)-f*(n[1]-q),l=f*(n[0]-p)-d*((n[2]||0)-r),s=Vector.create([e*j-f*l,f*k-d*j,d*l-e*k]),t=this.distanceFrom(n)/s.modulus();return Vector.create([n[0]+s.elements[0]*t,n[1]+s.elements[1]*t,(n[2]||0)+s.elements[2]*t])},rotate:function(a,b){"undefined"==typeof b.direction&&(b=Line.create(b.to3D(),Vector.k));var c=Matrix.Rotation(a,b.direction).elements,d=b.pointClosestTo(this.anchor).elements,e=this.anchor.elements,f=this.direction.elements,g=d[0],h=d[1],i=d[2],j=e[0],k=e[1],l=e[2],m=j-g,n=k-h,o=l-i;return Line.create([g+c[0][0]*m+c[0][1]*n+c[0][2]*o,h+c[1][0]*m+c[1][1]*n+c[1][2]*o,i+c[2][0]*m+c[2][1]*n+c[2][2]*o],[c[0][0]*f[0]+c[0][1]*f[1]+c[0][2]*f[2],c[1][0]*f[0]+c[1][1]*f[1]+c[1][2]*f[2],c[2][0]*f[0]+c[2][1]*f[1]+c[2][2]*f[2]])},reflectionIn:function(a){if(a.normal){var b=this.anchor.elements,c=this.direction.elements,d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=this.anchor.reflectionIn(a).elements,k=d+g,l=e+h,m=f+i,n=a.pointClosestTo([k,l,m]).elements,o=[n[0]+(n[0]-k)-j[0],n[1]+(n[1]-l)-j[1],n[2]+(n[2]-m)-j[2]];return Line.create(j,o)}if(a.direction)return this.rotate(Math.PI,a);var p=a.elements||a;return Line.create(this.anchor.reflectionIn([p[0],p[1],p[2]||0]),this.direction)},setVectors:function(a,b){if(a=Vector.create(a),b=Vector.create(b),2==a.elements.length&&a.elements.push(0),2==b.elements.length&&b.elements.push(0),a.elements.length>3||b.elements.length>3)return null;var c=b.modulus();return 0===c?null:(this.anchor=a,this.direction=Vector.create([b.elements[0]/c,b.elements[1]/c,b.elements[2]/c]),this)}},Line.create=function(a,b){var c=new Line;return c.setVectors(a,b)},Line.X=Line.create(Vector.Zero(3),Vector.i),Line.Y=Line.create(Vector.Zero(3),Vector.j),Line.Z=Line.create(Vector.Zero(3),Vector.k),Plane.prototype={eql:function(a){return this.contains(a.anchor)&&this.isParallelTo(a)},dup:function(){return Plane.create(this.anchor,this.normal)},translate:function(a){var b=a.elements||a;return Plane.create([this.anchor.elements[0]+b[0],this.anchor.elements[1]+b[1],this.anchor.elements[2]+(b[2]||0)],this.normal)},isParallelTo:function(a){var b;return a.normal?(b=this.normal.angleFrom(a.normal),Math.abs(b)<=Sylvester.precision||Math.abs(Math.PI-b)<=Sylvester.precision):a.direction?this.normal.isPerpendicularTo(a.direction):null},isPerpendicularTo:function(a){var b=this.normal.angleFrom(a.normal);return Math.abs(Math.PI/2-b)<=Sylvester.precision},distanceFrom:function(a){if(this.intersects(a)||this.contains(a))return 0;if(a.anchor){var b=this.anchor.elements,c=a.anchor.elements,d=this.normal.elements;return Math.abs((b[0]-c[0])*d[0]+(b[1]-c[1])*d[1]+(b[2]-c[2])*d[2])}var e=a.elements||a,b=this.anchor.elements,d=this.normal.elements;return Math.abs((b[0]-e[0])*d[0]+(b[1]-e[1])*d[1]+(b[2]-(e[2]||0))*d[2])},contains:function(a){if(a.normal)return null;if(a.direction)return this.contains(a.anchor)&&this.contains(a.anchor.add(a.direction));var b=a.elements||a,c=this.anchor.elements,d=this.normal.elements,e=Math.abs(d[0]*(c[0]-b[0])+d[1]*(c[1]-b[1])+d[2]*(c[2]-(b[2]||0)));return e<=Sylvester.precision},intersects:function(a){return"undefined"==typeof a.direction&&"undefined"==typeof a.normal?null:!this.isParallelTo(a)},intersectionWith:function(a){if(!this.intersects(a))return null;if(a.direction){var b=a.anchor.elements,c=a.direction.elements,d=this.anchor.elements,e=this.normal.elements,f=(e[0]*(d[0]-b[0])+e[1]*(d[1]-b[1])+e[2]*(d[2]-b[2]))/(e[0]*c[0]+e[1]*c[1]+e[2]*c[2]);return Vector.create([b[0]+c[0]*f,b[1]+c[1]*f,b[2]+c[2]*f])}if(a.normal){for(var g=this.normal.cross(a.normal).toUnitVector(),e=this.normal.elements,b=this.anchor.elements,h=a.normal.elements,i=a.anchor.elements,j=Matrix.Zero(2,2),k=0;j.isSingular();)k++,j=Matrix.create([[e[k%3],e[(k+1)%3]],[h[k%3],h[(k+1)%3]]]);for(var l=j.inverse().elements,m=e[0]*b[0]+e[1]*b[1]+e[2]*b[2],n=h[0]*i[0]+h[1]*i[1]+h[2]*i[2],o=[l[0][0]*m+l[0][1]*n,l[1][0]*m+l[1][1]*n],p=[],q=1;3>=q;q++)p.push(k==q?0:o[(q+(5-k)%3)%3]);return Line.create(p,g)}},pointClosestTo:function(a){var b=a.elements||a,c=this.anchor.elements,d=this.normal.elements,e=(c[0]-b[0])*d[0]+(c[1]-b[1])*d[1]+(c[2]-(b[2]||0))*d[2];return Vector.create([b[0]+d[0]*e,b[1]+d[1]*e,(b[2]||0)+d[2]*e])},rotate:function(a,b){var c=Matrix.Rotation(a,b.direction).elements,d=b.pointClosestTo(this.anchor).elements,e=this.anchor.elements,f=this.normal.elements,g=d[0],h=d[1],i=d[2],j=e[0],k=e[1],l=e[2],m=j-g,n=k-h,o=l-i;return Plane.create([g+c[0][0]*m+c[0][1]*n+c[0][2]*o,h+c[1][0]*m+c[1][1]*n+c[1][2]*o,i+c[2][0]*m+c[2][1]*n+c[2][2]*o],[c[0][0]*f[0]+c[0][1]*f[1]+c[0][2]*f[2],c[1][0]*f[0]+c[1][1]*f[1]+c[1][2]*f[2],c[2][0]*f[0]+c[2][1]*f[1]+c[2][2]*f[2]])},reflectionIn:function(a){if(a.normal){var b=this.anchor.elements,c=this.normal.elements,d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=this.anchor.reflectionIn(a).elements,k=d+g,l=e+h,m=f+i,n=a.pointClosestTo([k,l,m]).elements,o=[n[0]+(n[0]-k)-j[0],n[1]+(n[1]-l)-j[1],n[2]+(n[2]-m)-j[2]];return Plane.create(j,o)}if(a.direction)return this.rotate(Math.PI,a);var p=a.elements||a;return Plane.create(this.anchor.reflectionIn([p[0],p[1],p[2]||0]),this.normal)},setVectors:function(a,b,c){if(a=Vector.create(a),a=a.to3D(),null===a)return null;if(b=Vector.create(b),b=b.to3D(),null===b)return null;if("undefined"==typeof c)c=null;else if(c=Vector.create(c),c=c.to3D(),null===c)return null;var d,e,f=a.elements[0],g=a.elements[1],h=a.elements[2],i=b.elements[0],j=b.elements[1],k=b.elements[2];if(null!==c){var l=c.elements[0],m=c.elements[1],n=c.elements[2];if(d=Vector.create([(j-g)*(n-h)-(k-h)*(m-g),(k-h)*(l-f)-(i-f)*(n-h),(i-f)*(m-g)-(j-g)*(l-f)]),e=d.modulus(),0===e)return null;d=Vector.create([d.elements[0]/e,d.elements[1]/e,d.elements[2]/e])}else{if(e=Math.sqrt(i*i+j*j+k*k),0===e)return null;d=Vector.create([b.elements[0]/e,b.elements[1]/e,b.elements[2]/e])}return this.anchor=a,this.normal=d,this}},Plane.create=function(a,b,c){var d=new Plane;return d.setVectors(a,b,c)},Plane.XY=Plane.create(Vector.Zero(3),Vector.k),Plane.YZ=Plane.create(Vector.Zero(3),Vector.i),Plane.ZX=Plane.create(Vector.Zero(3),Vector.j),Plane.YX=Plane.XY,Plane.ZY=Plane.YZ,Plane.XZ=Plane.ZX;
var $V=Vector.create,$M=Matrix.create,$L=Line.create,$P=Plane.create;try{Modernizr.addTest("webrtc",!!Modernizr.prefixed("RTCPeerConnection",window))}catch(e){}Modernizr.addTest("devicemotion","DeviceMotionEvent"in window),Modernizr.addTest("deviceorientation","DeviceOrientationEvent"in window),Modernizr.addTest("borderradiusprefixed",Modernizr.testAllProps("borderRadius")),Modernizr.addTest("borderradius",Modernizr.testProp("borderRadius"));var blob=document.getElementById("blob"),inner=document.getElementById("inner"),innerC="#1f77b4 #aec7e8 #ff7f0e #ffbb78 #2ca02c #98df8a #d62728 #ff9896 #9467bd #c5b0d5 #8c564b #c49c94 #e377c2 #f7b6d2 #7f7f7f #c7c7c7 #bcbd22 #dbdb8d #17becf #9edae5".split(" ")[Math.floor(20*Math.random())],outerC="#3182bd #6baed6 #9ecae1 #c6dbef #e6550d #fd8d3c #fdae6b #fdd0a2 #31a354 #74c476 #a1d99b #c7e9c0 #756bb1 #9e9ac8 #bcbddc #dadaeb #636363 #969696 #bdbdbd #d9d9d9".split(" ")[Math.floor(20*Math.random())];blob.style.background=outerC,inner.style.background=innerC;var feats=[];for(var feat in Modernizr)Modernizr[feat]===!0&&feats.push(feat);var pixels=0;try{pixels=screen.height*screen.width}catch(e){}var id=document.location.hash||(document.location.hash=PUBNUB.uuid());"#"===id.charAt(0)&&(id=id.substr(1));var pubnub=PUBNUB.init({publish_key:"pub-c-0776ca68-c17d-4d5e-9955-72425215955d",subscribe_key:"sub-c-4e3d33da-15a8-11e3-92f9-02ee2ddab7fe",uuid:id});pubnub.publish({channel:"guests",message:{uuid:id,type:"hello",features:feats.join(" "),pixels:pixels,outer:outerC,inner:innerC}});for(var caps=document.querySelectorAll("#capabilities li"),i=caps.length-1;i>=0;i--){var cap=caps[i],newNode=document.createElement("div");newNode.className="vote-panel",newNode.innerHTML=choice_src.innerHTML,function(a){var b,c,d=newNode.querySelectorAll("input");d[0].addEventListener("change",function(){clearTimeout(b),b=setTimeout(function(){console.log(a,"awesome",d[0].value),pubnub.publish({channel:"guests",message:{id:id,type:"vote",value:[a,"awesome",d[0].value]}})},200)},!1),d[1].addEventListener("change",function(){clearTimeout(c),c=setTimeout(function(){console.log(a,"knowledge",d[1].value),pubnub.publish({channel:"guests",message:{id:id,type:"vote",value:[a,"knowledge",d[1].value]}})},200)},!1)}(cap.id.substr(5)),cap.parentNode.insertBefore(newNode,cap.nextSibling)}var callback=function(){var a,b=[],c=!1;return function(d){if(c){if(console&&console.log("message!",d),d.slide&&show("slide",d.slide),d.fragment&&(show("fragment",d.fragment),"capabilities"===d.fragment&&(document.getElementById("blobpanel").style.display="block")),d.hello){var e=document.createElement("img");e.src=d.hello,document.getElementById("hello-image").innerHTML="",document.getElementById("hello-image").appendChild(e)}if(d.tweet){document.getElementById("tweet").innerHTML=d.tweet;var f=document.createElement("script");f.async=!0,f.src="//platform.twitter.com/widgets.js",document.body.appendChild(f)}d.show_all&&(document.getElementById("blobpanel").style.display="block"),d.start_votes&&(document.body.className="voting-active")}else a&&clearTimeout(a),b.push(d),a=setTimeout(function(){c=!0;for(var a=0,d=0;d<b.length;d++)b[d].party_started&&(a=d);b=b.slice(a);for(var d=0;d<b.length;d++)callback(b[d])},50)}}();pubnub.subscribe({channel:"host",connect:function(){document.getElementById("hello").style.color="#08f"},restore:!0,backfill:!0,callback:callback});var fTimeout;bean.on(blob,"click",function(a){a.stop(),a.stopImmediatePropagation();var b=coordecode(a,blob);pubnub.publish({channel:"guests",message:{uuid:id,type:"go",x:b.x,y:b.y}}),feedback(b)}),bean.on(blob,"touchstart",function(a){a.stop(),a.stopImmediatePropagation();var b=touchCoord(a,blob);pubnub.publish({channel:"guests",message:{uuid:id,type:"go",x:b.x,y:b.y}}),feedback(b)}),bean.on(document.getElementById("fullscreen"),"click",function(){document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)});var uuid=id;publishDimensions(),window.addEventListener("resize",throttle(publishDimensions,2e3),!1);var element=document.getElementById("item"),divstyle=element.style,tranformProp="transform"in divstyle?"transform":"MozTransform"in divstyle?"MozTransform":"WebkitTransform"in divstyle?"WebkitTransform":"OTransform"in divstyle?"OTransform":"msTransform"in divstyle?"msTransform":"transform";pubnub.subscribe({channel:"idmt-state",message:function(a){element.style.display="block",element.style.opacity=1,element.style[tranformProp]=css(localtransform)+" "+a}});var localtransform=Matrix.I(3);pubnub.subscribe({channel:"idmt-positions",message:function(a){console.log("got positions",a);for(var b=a.length-1;b>=0;b--)if(a[b][0]==uuid){var c=a[b][1],d=a[b][2],e=a[b][3];localtransform=$M([[1/e,0,0],[0,1/e,0],[0,0,1]]).x($M([[1,0,-c],[0,1,-d],[0,0,1]])),element.style[tranformProp]=css(localtransform)}}});var throttled_publish=throttle(function(a){pubnub.publish({channel:"idmt-touches",message:a})},200),hammer=Hammer(item).on("touchmove",function(a){a.preventDefault()}).on("drag",function(a){a.preventDefault();var b=a.gesture,c=b.touches[0],d=localtransform.inverse().x($V([c.pageX,c.pageY,1]));throttled_publish({id:uuid,x:d.elements[0],y:d.elements[1]})});