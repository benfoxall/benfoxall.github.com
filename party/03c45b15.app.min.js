function unique(){return"x"+ ++NOW+ +new Date}function rnow(){return+new Date}function build_url(a,b){var c=a.join(URLBIT),d=[];return b?(each(b,function(a,b){d.push(a+"="+encode(b))}),c+="?"+d.join(PARAMSBIT)):c}function updater(a,b){var c,d=0,e=function(){d+b>rnow()?(clearTimeout(c),c=setTimeout(e,b)):(d=rnow(),a())};return e}function grep(a,b){var c=[];return each(a||[],function(a){b(a)&&c.push(a)}),c}function supplant(a,b){return a.replace(REPL,function(a,c){return b[c]||a})}function timeout(a,b){return setTimeout(a,b)}function uuid(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)});return a&&a(b),b}function each(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;d>c;)b.call(a[c],a[c],c++);else for(var c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function map(a,b){var c=[];return each(a||[],function(a,d){c.push(b(a,d))}),c}function encode(a){return map(encodeURIComponent(a).split(""),function(a){return"-_.!~*'()".indexOf(a)<0?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function generate_channel_list(a){var b=[];return each(a,function(a,c){c.subscribed&&b.push(a)}),b.sort()}function ready(){timeout(function(){READY||(READY=1,each(READY_BUFFER,function(a){a()}))},SECOND)}function PN_API(a){function b(a){a&&(s.sending=0),!s.sending&&s.length&&(s.sending=1,z(s.shift()))}function c(a){var b=0;return each(generate_channel_list(y),function(c){var d=y[c];d&&(b++,(a||function(){})(d))}),b}function d(){B()||f(1),timeout(d,SECOND)}function e(){F.time(function(a){a||f(1),timeout(e,i)})}function f(a){v&&v(a),v=null}var g=+a.windowing||DEF_WINDOWING,h=(+a.timeout||DEF_SUB_TIMEOUT)*SECOND,i=(+a.keepalive||DEF_KEEPALIVE)*SECOND,j=a.noleave||0,k=a.publish_key||"",l=a.subscribe_key||"",m=a.auth_key||"",n=a.ssl?"s":"",o="http"+n+"://"+(a.origin||"pubsub.pubnub.com"),p=nextorigin(o),q=nextorigin(o),r=function(){},s=[],t=0,u=0,v=0,w=0,x=0,y={},z=a.xdr,A=a.error||function(){},B=a._is_online||function(){return 1},C=a.jsonp_cb||function(){return 0},D=a.db||{get:function(){},set:function(){}},E=a.uuid||D&&D.get(l+"uuid")||"",F={LEAVE:function(a,b){var c={uuid:E,auth:m},d=nextorigin(o),e=C();a.indexOf(PRESENCE_SUFFIX)>0||j||("0"!=e&&(c.callback=e),z({blocking:b||n,timeout:2e3,callback:e,data:c,url:[d,"v2","presence","sub_key",l,"channel",encode(a),"leave"]}))},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||function(){},f=a.channel,g=a.start,h=a.end,i={},j=C();return f?b?l?(i.stringtoken="true",i.count=c,i.reverse=d,i.auth=m,j&&(i.callback=j),g&&(i.start=g),h&&(i.end=h),z({callback:j,data:i,success:function(a){b(a)},fail:e,url:[p,"v2","history","sub-key",l,"channel",encode(f)]}),void 0):A("Missing Subscribe Key"):A("Missing Callback"):A("Missing Channel")},replay:function(a){var b,c=c||a.callback||function(){},d=a.source,e=a.destination,f=a.stop,g=a.start,h=a.end,i=a.reverse,j=a.limit,n=C(),o={};return d?e?k?l?("0"!=n&&(o.callback=n),f&&(o.stop="all"),i&&(o.reverse="true"),g&&(o.start=g),h&&(o.end=h),j&&(o.count=j),o.auth=m,b=[p,"v1","replay",k,l,d,e],z({callback:n,success:function(a){c(a)},fail:function(){c([0,"Disconnected"])},url:b,data:o}),void 0):A("Missing Subscribe Key"):A("Missing Publish Key"):A("Missing Destination Channel"):A("Missing Source Channel")},auth:function(a){m=a,r()},time:function(a){var b=C();z({callback:b,data:{uuid:E,auth:m},timeout:5*SECOND,url:[p,"time",b],success:function(b){a(b[0])},fail:function(){a(0)}})},publish:function(a,c){var d,c=c||a.callback||function(){},e=a.message,f=a.channel,g=C();return e?f?k?l?(e=JSON.stringify(e),d=[p,"publish",k,l,0,encode(f),g,encode(e)],s.push({callback:g,timeout:5*SECOND,url:d,data:{uuid:E,auth:m},success:function(a){c(a),b(1)},fail:function(){c([0,"Failed",e]),b(1)}}),b(),void 0):A("Missing Subscribe Key"):A("Missing Publish Key"):A("Missing Channel"):A("Missing Message")},unsubscribe:function(a){var b=a.channel;x=0,w=1,b=map((b.join?b.join(","):""+b).split(","),function(a){return a+","+a+PRESENCE_SUFFIX}).join(","),each(b.split(","),function(a){READY&&F.LEAVE(a,0),y[a]=0}),r()},subscribe:function(a,b){function d(a){a?timeout(r,SECOND):(p=nextorigin(o,1),q=nextorigin(o,1),timeout(function(){F.time(d)},SECOND)),c(function(b){return a&&b.disconnected?(b.disconnected=0,b.reconnect(b.name)):(a||b.disconnected||(b.disconnected=1,b.disconnect(b.name)),void 0)})}function e(){var a=C(),b=generate_channel_list(y).join(",");b&&(f(),v=z({timeout:J,callback:a,fail:function(){v=null,F.time(d)},data:{uuid:E,auth:m},url:[q,"subscribe",l,encode(b),a,x],success:function(a){if(v=null,!a||"object"==typeof a&&"error"in a&&!a.error)return s(a),timeout(r,K);x=!x&&w&&D.get(l)||a[1],c(function(a){a.connected||(a.connected=1,a.connect(a.name))}),H&&(x=1e4,H=0),D.set(l,a[1]);var b=function(){var b=a.length>2?a[2]:map(y,function(b){return map(Array(a[0].length).join(",").split(","),function(){return b})}).join(","),c=b.split(",");return function(){var a=c.shift()||u;return[(y[a]||{}).callback||t,a.split(PRESENCE_SUFFIX)[0]]}}();each(a[0],function(c){var d=b();d[0](c,a,d[1])}),timeout(e,K)}}))}var i=a.channel,b=b||a.callback,b=b||a.message,j=a.connect||function(){},k=a.reconnect||function(){},n=a.disconnect||function(){},s=a.error||function(){},B=a.presence||0,G=a.noheresync||0,H=a.backfill||0,I=a.timetoken||0,J=a.timeout||h,K=a.windowing||g,L=a.restore;return w=L,x=I,i?b?l?(each((i.join?i.join(","):""+i).split(","),function(a){var c=y[a]||{};y[u=a]={name:a,connected:c.connected,disconnected:c.disconnected,subscribed:1,callback:t=b,connect:j,disconnect:n,reconnect:k},B&&(F.subscribe({channel:a+PRESENCE_SUFFIX,callback:B}),c.subscribed||G||F.here_now({channel:a,callback:function(b){each("uuids"in b?b.uuids:[],function(c){B({action:"join",uuid:c,timestamp:rnow(),occupancy:b.occupancy||1},b,a)})}}))}),r=function(){f(),timeout(e,K)},READY?(r(),void 0):READY_BUFFER.push(r)):A("Missing Subscribe Key"):A("Missing Callback"):A("Missing Channel")},here_now:function(a,b){var b=a.callback||b,c=a.error||function(){},d=a.channel,e=C(),f={uuid:E,auth:m};return d?b?l?("0"!=e&&(f.callback=e),z({callback:e,data:f,success:function(a){b(a,d)},fail:c,url:[p,"v2","presence","sub_key",l,"channel",encode(d)]}),void 0):A("Missing Subscribe Key"):A("Missing Callback"):A("Missing Channel")},xdr:z,ready:ready,db:D,uuid:uuid,map:map,each:each,"each-channel":c,grep:grep,offline:function(){f(1)},supplant:supplant,now:rnow,unique:unique,updater:updater};return E||(E=F.uuid()),D.set(l+"uuid",E),timeout(d,SECOND),timeout(e,i),F.time(function(){}),F}function partyHandler(){}function show(a,b){var c=document.getElementById(b);if(c)for(var d=document.getElementsByClassName(a),e=0;e<d.length;e++)d[e].className=d[e]===c?a+" on":a}function coordecode(a,b){var c=0,d=0;if(!a)var a=window.event;a.pageX||a.pageY?(c=a.pageX,d=a.pageY):(a.clientX||a.clientY)&&(c=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);var e=b.getBoundingClientRect();return{x:c-e.left-e.width/2,y:d-e.top-e.height/2}}function touchCoord(a,b){console.log(a.touches[0]);var c=a.touches[0].pageX,d=a.touches[0].pageY,e=b.getBoundingClientRect();return{x:c-e.left-e.width/2,y:d-e.top-e.height/2}}window.Modernizr=function(a,b,c){function d(a){s.cssText=a}function e(a,b){return typeof a===b}function f(a,b){return!!~(""+a).indexOf(b)}function g(a,b){for(var d in a){var e=a[d];if(!f(e,"-")&&s[e]!==c)return"pfx"==b?e:!0}return!1}function h(a,b,d){for(var f in a){var g=b[a[f]];if(g!==c)return d===!1?a[f]:e(g,"function")?g.bind(d||b):g}return!1}function i(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),f=(a+" "+v.join(d+" ")+d).split(" ");return e(b,"string")||e(b,"undefined")?g(f,b):(f=(a+" "+w.join(d+" ")+d).split(" "),h(f,b,c))}var j,k,l,m="2.6.2",n={},o=!0,p=b.documentElement,q="modernizr",r=b.createElement(q),s=r.style,t=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),u="Webkit Moz O ms",v=u.split(" "),w=u.toLowerCase().split(" "),x={},y=[],z=y.slice,A=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:q+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',q,'">',a,"</style>"].join(""),j.id=q,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=p.style.overflow,p.style.overflow="hidden",p.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),p.style.overflow=i),!!g},B=function(){function a(a,f){f=f||b.createElement(d[a]||"div"),a="on"+a;var g=a in f;return g||(f.setAttribute||(f=b.createElement("div")),f.setAttribute&&f.removeAttribute&&(f.setAttribute(a,""),g=e(f[a],"function"),e(f[a],"undefined")||(f[a]=c),f.removeAttribute(a))),f=null,g}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),C={}.hasOwnProperty;l=e(C,"undefined")||e(C.call,"undefined")?function(a,b){return b in a&&e(a.constructor.prototype[b],"undefined")}:function(a,b){return C.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=z.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(z.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(z.call(arguments)))};return d}),x.webgl=function(){return!!a.WebGLRenderingContext},x.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:A(["@media (",t.join("touch-enabled),("),q,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},x.geolocation=function(){return"geolocation"in navigator},x.indexedDB=function(){return!!i("indexedDB",a)},x.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},x.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},x.cssanimations=function(){return i("animationName")},x.csstransforms=function(){return!!i("transform")},x.csstransforms3d=function(){var a=!!i("perspective");return a&&"webkitPerspective"in p.style&&A("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},x.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(d){}return c},x.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(d){}return c},x.localstorage=function(){try{return localStorage.setItem(q,q),localStorage.removeItem(q),!0}catch(a){return!1}},x.sessionstorage=function(){try{return sessionStorage.setItem(q,q),sessionStorage.removeItem(q),!0}catch(a){return!1}},x.webworkers=function(){return!!a.Worker},x.applicationcache=function(){return!!a.applicationCache};for(var D in x)l(x,D)&&(k=D.toLowerCase(),n[k]=x[D](),y.push((n[k]?"":"no-")+k));return n.addTest=function(a,b){if("object"==typeof a)for(var d in a)l(a,d)&&n.addTest(d,a[d]);else{if(a=a.toLowerCase(),n[a]!==c)return n;b="function"==typeof b?b():b,"undefined"!=typeof o&&o&&(p.className+=" feat-"+(b?"":"no-")+a),n[a]=b}return n},d(""),r=j=null,n._version=m,n._prefixes=t,n._domPrefixes=w,n._cssomPrefixes=v,n.hasEvent=B,n.testProp=function(a){return g([a])},n.testAllProps=i,n.testStyles=A,n.prefixed=function(a,b,c){return b?i(a,b,c):i(a,"pfx")},p.className=p.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(o?" feat-js feat-"+y.join(" feat-"):""),n}(this,this.document),Modernizr.addTest("battery",!!Modernizr.prefixed("battery",navigator)),Modernizr.addTest("fullscreen",function(){for(var a=0;a<Modernizr._domPrefixes.length;a++)if(document[Modernizr._domPrefixes[a].toLowerCase()+"CancelFullScreen"])return!0;return!!document.cancelFullScreen||!1}),Modernizr.addTest("vibrate",!!Modernizr.prefixed("vibrate",navigator)),Modernizr.addTest("gamepads",!!Modernizr.prefixed("getGamepads",navigator)),window.JSON&&window.JSON.stringify||function(){function toJSON(){try{return this.valueOf()}catch(a){return null}}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&(i=toJSON.call(i,a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)d=rep[c],"string"==typeof d&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}window.JSON||(window.JSON={});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text){return eval("("+text+")")})}();var NOW=1,READY=!1,READY_BUFFER=[],PRESENCE_SUFFIX="-pnpres",DEF_WINDOWING=10,DEF_TIMEOUT=1e4,DEF_SUB_TIMEOUT=310,DEF_KEEPALIVE=60,SECOND=1e3,URLBIT="/",PARAMSBIT="&",REPL=/{([\w\-]+)}/g,nextorigin=function(){var a=20,b=Math.floor(Math.random()*a);return function(c,d){return c.indexOf("pubsub.")>0&&c.replace("pubsub","ps"+(d?uuid().split("-")[0]:++b<a?b:b=1))||c}}();window.PUBNUB||function(){function a(a){return document.getElementById(a)}function b(a){console.error(a)}function c(a,b){var c=[];return each(a.split(/\s+/),function(a){each((b||document).getElementsByTagName(a),function(a){c.push(a)})}),c}function d(a,b,c){each(a.split(","),function(a){var d=function(a){a||(a=window.event),c(a)||(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())};b.addEventListener?b.addEventListener(a,d,!1):b.attachEvent?b.attachEvent("on"+a,d):b["on"+a]=d})}function e(){return c("head")[0]}function f(a,b,c){return c?(a.setAttribute(b,c),void 0):a&&a.getAttribute&&a.getAttribute(b)}function g(a,b){for(var c in b)if(b.hasOwnProperty(c))try{a.style[c]=b[c]+("|width|height|top|left|".indexOf(c)>0&&"number"==typeof b[c]?"px":"")}catch(d){}}function h(a){return document.createElement(a)}function i(){return r||m()?0:unique()}function j(b){if(r||m())return k(b);var c=h("script"),d=b.callback,g=unique(),i=0,j=b.timeout||DEF_TIMEOUT,l=timeout(function(){u(1)},j),n=b.fail||function(){},p=b.data||{},s=b.success||function(){},t=function(){e().appendChild(c)},u=function(b,d){i||(i=1,c.onerror=null,clearTimeout(l),b||!d||s(d),timeout(function(){b&&n();var c=a(g),d=c&&c.parentNode;d&&d.removeChild(c)},SECOND))};return window[d]=function(a){u(0,a)},b.blocking||(c[o]=o),c.onerror=function(){u(1)},p.pnsdk=q,c.src=build_url(b.url,p),f(c,"id",g),t(),u}function k(a){var b,c,d=function(){if(!f){f=1,clearTimeout(h);try{c=JSON.parse(b.responseText)}catch(a){return o(1)}e=1,l(c)}},e=0,f=0,g=a.timeout||DEF_TIMEOUT,h=timeout(function(){o(1)},g),i=a.fail||function(){},k=a.data||{},l=a.success||function(){},n="undefined"==typeof a.blocking,o=function(a){e||(e=1,clearTimeout(h),b&&(b.onerror=b.onload=null,b.abort&&b.abort(),b=null),a&&i())};try{b=m()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest,b.onerror=b.onabort=function(){o(1)},b.onload=b.onloadend=d,n&&(b.timeout=g),k.pnsdk=q;var p=build_url(a.url,k);b.open("GET",p,n),b.send()}catch(s){return o(0),r=0,j(a)}return o}function l(){return"onLine"in navigator?navigator.onLine:1}function m(){if(!x||!x.get)return 0;var a={id:m.id++,send:function(){},abort:function(){a.id={}},open:function(b,c){m[a.id]=a,x.get(a.id,c)}};return a}var n="https://pubnub.a.ssl.fastly.net/pubnub.swf",o="async",p=navigator.userAgent,q="PubNub-JS-Web/3.5.3.1",r=-1==p.indexOf("MSIE 6");window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||function(){});var s=function(){var a=window.localStorage;return{get:function(b){try{return a?a.getItem(b):-1==document.cookie.indexOf(b)?null:((document.cookie||"").match(RegExp(b+"=([^;]+)"))||[])[1]||null}catch(c){return}},set:function(b,c){try{if(a)return a.setItem(b,c)&&0;document.cookie=b+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(d){return}}}}(),t={list:{},unbind:function(a){t.list[a]=[]},bind:function(a,b){(t.list[a]=t.list[a]||[]).push(b)},fire:function(a,b){each(t.list[a]||[],function(a){a(b)})}},u=a("pubnub")||0,v=function(k){k.jsonp&&(r=0);var m=k.subscribe_key||"";(+k.keepalive||DEF_KEEPALIVE)*SECOND,k.uuid||s.get(m+"uuid")||"",k.xdr=j,k.db=s,k.error=b,k._is_online=l,k.jsonp_cb=i;var n=PN_API(k);return n.css=g,n.$=a,n.create=h,n.bind=d,n.head=e,n.search=c,n.attr=f,n.events=t,n.init=v,d("beforeunload",window,function(){return n["each-channel"](function(a){n.LEAVE(a.name,0)}),!0}),k.notest?n:(d("offline",window,n.offline),d("offline",document,n.offline),n)};d("load",window,function(){timeout(ready,0)});var w=u||{};PUBNUB=v({notest:1,publish_key:f(w,"pub-key"),subscribe_key:f(w,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==f(w,"ssl"),origin:f(w,"origin"),uuid:f(w,"uuid")}),window.jQuery&&(window.jQuery.PUBNUB=PUBNUB),"undefined"!=typeof module&&(module.exports=PUBNUB)&&ready();var x=a("pubnubs")||0;u&&(g(u,{position:"absolute",top:-SECOND}),("opera"in window||f(u,"flash"))&&(u.innerHTML="<object id=pubnubs data="+n+"><param name=movie value="+n+"><param name=allowscriptaccess value=always></object>"),PUBNUB.rdx=function(a,b){return b?(m[a].responseText=unescape(b),m[a].onload(),void 0):m[a].onerror()},m.id=SECOND)}(),function(){var a=PUBNUB.ws=function(b,c){if(!(this instanceof a))return new a(b,c);var d=this,b=d.url=b||"",e=(d.protocol=c||"Sec-WebSocket-Protocol",b.split("/")),f={ssl:"wss:"===e[0],origin:e[2],publish_key:e[3],subscribe_key:e[4],channel:e[5]};return d.CONNECTING=0,d.OPEN=1,d.CLOSING=2,d.CLOSED=3,d.CLOSE_NORMAL=1e3,d.CLOSE_GOING_AWAY=1001,d.CLOSE_PROTOCOL_ERROR=1002,d.CLOSE_UNSUPPORTED=1003,d.CLOSE_TOO_LARGE=1004,d.CLOSE_NO_STATUS=1005,d.CLOSE_ABNORMAL=1006,d.onclose=d.onerror=d.onmessage=d.onopen=d.onsend=function(){},d.binaryType="",d.extensions="",d.bufferedAmount=0,d.trasnmitting=!1,d.buffer=[],d.readyState=d.CONNECTING,b?(d.pubnub=PUBNUB.init(f),d.pubnub.setup=f,d.setup=f,d.pubnub.subscribe({restore:!1,channel:f.channel,disconnect:d.onerror,reconnect:d.onopen,error:function(){d.onclose({code:d.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!1})},callback:function(a){d.onmessage({data:a})},connect:function(){d.readyState=d.OPEN,d.onopen()}}),void 0):(d.readyState=d.CLOSED,d.onclose({code:d.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),d)};a.prototype.send=function(a){var b=this;b.pubnub.publish({channel:b.pubnub.setup.channel,message:a,callback:function(a){b.onsend({data:a})}})},a.prototype.close=function(){var a=this;a.pubnub.unsubscribe({channel:a.pubnub.setup.channel}),a.readyState=a.CLOSED,a.onclose({})}}(),function(a,b,c){"undefined"!=typeof module&&module.exports?module.exports=c():"function"==typeof define&&define.amd?define(c):b[a]=c()}("bean",this,function(a,b){a=a||"bean",b=b||this;var c,d=window,e=b[a],f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="removeEventListener",j=document||{},k=j.documentElement||{},l=k[h],m=l?h:"attachEvent",n={},o=Array.prototype.slice,p=function(a,b){return a.split(b||" ")},q=function(a){return"string"==typeof a},r=function(a){return"function"==typeof a},s="click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange message error abort scroll ",t="show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend textinputreadystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ",u=function(a,b,c){for(c=0;c<b.length;c++)b[c]&&(a[b[c]]=1);return a}({},p(s+(l?t:""))),v=function(){var a="compareDocumentPosition"in k?function(a,b){return b.compareDocumentPosition&&16===(16&b.compareDocumentPosition(a))}:"contains"in k?function(a,b){return b=9===b.nodeType||b===window?k:b,b!==a&&b.contains(a)}:function(a,b){for(;a=a.parentNode;)if(a===b)return 1;return 0},b=function(b){var c=b.relatedTarget;return c?c!==this&&"xul"!==c.prefix&&!/document/.test(this.toString())&&!a(c,this):null==c};return{mouseenter:{base:"mouseover",condition:b},mouseleave:{base:"mouseout",condition:b},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),w=function(){var a=p("altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which propertyName"),b=a.concat(p("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement")),c=b.concat(p("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis")),e=a.concat(p("char charCode key keyCode keyIdentifier keyLocation location")),f=a.concat(p("data")),g=a.concat(p("touches targetTouches changedTouches scale rotation")),h=a.concat(p("data origin source")),i=a.concat(p("state")),l=/over|out/,m=[{reg:/key/i,fix:function(a,b){return b.keyCode=a.keyCode||a.which,e}},{reg:/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,fix:function(a,c,d){return c.rightClick=3===a.which||2===a.button,c.pos={x:0,y:0},a.pageX||a.pageY?(c.clientX=a.pageX,c.clientY=a.pageY):(a.clientX||a.clientY)&&(c.clientX=a.clientX+j.body.scrollLeft+k.scrollLeft,c.clientY=a.clientY+j.body.scrollTop+k.scrollTop),l.test(d)&&(c.relatedTarget=a.relatedTarget||a[("mouseover"==d?"from":"to")+"Element"]),b}},{reg:/mouse.*(wheel|scroll)/i,fix:function(){return c}},{reg:/^text/i,fix:function(){return f}},{reg:/^touch|^gesture/i,fix:function(){return g}},{reg:/^message$/i,fix:function(){return h}},{reg:/^popstate$/i,fix:function(){return i}},{reg:/.*/,fix:function(){return a}}],n={},o=function(a,b,c){if(arguments.length&&(a=a||((b.ownerDocument||b.document||b).parentWindow||d).event,this.originalEvent=a,this.isNative=c,this.isBean=!0,a)){var e,f,g,h,i,j=a.type,k=a.target||a.srcElement;if(this.target=k&&3===k.nodeType?k.parentNode:k,c){if(i=n[j],!i)for(e=0,f=m.length;f>e;e++)if(m[e].reg.test(j)){n[j]=i=m[e].fix;break}for(h=i(a,this,j),e=h.length;e--;)!((g=h[e])in this)&&g in a&&(this[g]=a[g])}}};return o.prototype.preventDefault=function(){this.originalEvent.preventDefault?this.originalEvent.preventDefault():this.originalEvent.returnValue=!1},o.prototype.stopPropagation=function(){this.originalEvent.stopPropagation?this.originalEvent.stopPropagation():this.originalEvent.cancelBubble=!0},o.prototype.stop=function(){this.preventDefault(),this.stopPropagation(),this.stopped=!0},o.prototype.stopImmediatePropagation=function(){this.originalEvent.stopImmediatePropagation&&this.originalEvent.stopImmediatePropagation(),this.isImmediatePropagationStopped=function(){return!0}},o.prototype.isImmediatePropagationStopped=function(){return this.originalEvent.isImmediatePropagationStopped&&this.originalEvent.isImmediatePropagationStopped()},o.prototype.clone=function(a){var b=new o(this,this.element,this.isNative);return b.currentTarget=a,b},o}(),x=function(a,b){return l||b||a!==j&&a!==d?a:k},y=function(){var a=function(a,b,c,d){var e=function(c,e){return b.apply(a,d?o.call(e,c?0:1).concat(d):e)},f=function(c,d){return b.__beanDel?b.__beanDel.ft(c.target,a):d},g=c?function(a){var b=f(a,this);return c.apply(b,arguments)?(a&&(a.currentTarget=b),e(a,arguments)):void 0}:function(a){return b.__beanDel&&(a=a.clone(f(a))),e(a,arguments)};return g.__beanDel=b.__beanDel,g},b=function(b,c,d,e,f,g,h){var i,j=v[c];"unload"==c&&(d=D(E,b,c,d,e)),j&&(j.condition&&(d=a(b,d,j.condition,g)),c=j.base||c),this.isNative=i=u[c]&&!!b[m],this.customType=!l&&!i&&c,this.element=b,this.type=c,this.original=e,this.namespaces=f,this.eventType=l||i?c:"propertychange",this.target=x(b,i),this[m]=!!this.target[m],this.root=h,this.handler=a(b,d,null,g)};return b.prototype.inNamespaces=function(a){var b,c,d=0;if(!a)return!0;if(!this.namespaces)return!1;for(b=a.length;b--;)for(c=this.namespaces.length;c--;)a[b]==this.namespaces[c]&&d++;return a.length===d},b.prototype.matches=function(a,b,c){return!(this.element!==a||b&&this.original!==b||c&&this.handler!==c)},b}(),z=function(){var a={},b=function(c,d,e,f,g,h){var i=g?"r":"$";if(d&&"*"!=d){var j,k=0,l=a[i+d],m="*"==c;if(!l)return;for(j=l.length;j>k;k++)if((m||l[k].matches(c,e,f))&&!h(l[k],l,k,d))return}else for(var n in a)n.charAt(0)==i&&b(c,n.substr(1),e,f,g,h)},c=function(b,c,d,e){var f,g=a[(e?"r":"$")+c];if(g)for(f=g.length;f--;)if(!g[f].root&&g[f].matches(b,d,null))return!0;return!1},d=function(a,c,d,e){var f=[];return b(a,c,d,null,e,function(a){return f.push(a)}),f},e=function(b){var c=!b.root&&!this.has(b.element,b.type,null,!1),d=(b.root?"r":"$")+b.type;return(a[d]||(a[d]=[])).push(b),c},f=function(c){b(c.element,c.type,null,c.handler,c.root,function(b,c,d){return c.splice(d,1),b.removed=!0,0===c.length&&delete a[(b.root?"r":"$")+b.type],!1})},g=function(){var b,c=[];for(b in a)"$"==b.charAt(0)&&(c=c.concat(a[b]));return c};return{has:c,get:d,put:e,del:f,entries:g}}(),A=function(a){c=arguments.length?a:j.querySelectorAll?function(a,b){return b.querySelectorAll(a)}:function(){throw new Error("Bean: No selector engine installed")}},B=function(a,b){if(l||!b||!a||a.propertyName=="_on"+b){var c=z.get(this,b||a.type,null,!1),d=c.length,e=0;for(a=new w(a,this,!0),b&&(a.type=b);d>e&&!a.isImmediatePropagationStopped();e++)c[e].removed||c[e].handler.call(this,a)}},C=l?function(a,b,c){a[c?h:i](b,B,!1)}:function(a,b,c,d){var e;c?(z.put(e=new y(a,d||b,function(b){B.call(a,b,d)},B,null,null,!0)),d&&null==a["_on"+d]&&(a["_on"+d]=0),e.target.attachEvent("on"+e.eventType,e.handler)):(e=z.get(a,d||b,B,!0)[0],e&&(e.target.detachEvent("on"+e.eventType,e.handler),z.del(e)))},D=function(a,b,c,d,e){return function(){d.apply(this,arguments),a(b,c,e)}},E=function(a,b,c,d){var e,f,h=b&&b.replace(g,""),i=z.get(a,h,null,!1),j={};for(e=0,f=i.length;f>e;e++)c&&i[e].original!==c||!i[e].inNamespaces(d)||(z.del(i[e]),!j[i[e].eventType]&&i[e][m]&&(j[i[e].eventType]={t:i[e].eventType,c:i[e].type}));for(e in j)z.has(a,j[e].t,null,!1)||C(a,j[e].t,!1,j[e].c)},F=function(a,b){var d=function(b,d){for(var e,f=q(a)?c(a,d):a;b&&b!==d;b=b.parentNode)for(e=f.length;e--;)if(f[e]===b)return b},e=function(a){var c=d(a.target,this);c&&b.apply(c,arguments)};return e.__beanDel={ft:d,selector:a},e},G=l?function(a,b,c){var e=j.createEvent(a?"HTMLEvents":"UIEvents");e[a?"initEvent":"initUIEvent"](b,!0,!0,d,1),c.dispatchEvent(e)}:function(a,b,c){c=x(c,a),a?c.fireEvent("on"+b,j.createEventObject()):c["_on"+b]++},H=function(a,b,c){var d,e,h,i,j=q(b);if(j&&b.indexOf(" ")>0){for(b=p(b),i=b.length;i--;)H(a,b[i],c);return a}if(e=j&&b.replace(g,""),e&&v[e]&&(e=v[e].base),!b||j)(h=j&&b.replace(f,""))&&(h=p(h,".")),E(a,e,c,h);else if(r(b))E(a,null,b);else for(d in b)b.hasOwnProperty(d)&&H(a,d,b[d]);return a},I=function(a,b,d,e){var h,i,j,k,l,q,s;{if(void 0!==d||"object"!=typeof b){for(r(d)?(l=o.call(arguments,3),e=h=d):(h=e,l=o.call(arguments,4),e=F(d,h,c)),j=p(b),this===n&&(e=D(H,a,b,e,h)),k=j.length;k--;)s=z.put(q=new y(a,j[k].replace(g,""),e,h,p(j[k].replace(f,""),"."),l,!1)),q[m]&&s&&C(a,q.eventType,!0,q.customType);return a}for(i in b)b.hasOwnProperty(i)&&I.call(this,a,i,b[i])}},J=function(a,b,c,d){return I.apply(null,q(c)?[a,c,b,d].concat(arguments.length>3?o.call(arguments,5):[]):o.call(arguments))},K=function(){return I.apply(n,arguments)},L=function(a,b,c){var d,e,h,i,j,k=p(b);for(d=k.length;d--;)if(b=k[d].replace(g,""),(i=k[d].replace(f,""))&&(i=p(i,".")),i||c||!a[m])for(j=z.get(a,b,null,!1),c=[!1].concat(c),e=0,h=j.length;h>e;e++)j[e].inNamespaces(i)&&j[e].handler.apply(a,c);else G(u[b],b,a);return a},M=function(a,b,c){for(var d,e,f=z.get(b,c,null,!1),g=f.length,h=0;g>h;h++)f[h].original&&(d=[a,f[h].type],(e=f[h].handler.__beanDel)&&d.push(e.selector),d.push(f[h].original),I.apply(null,d));return a},N={on:I,add:J,one:K,off:H,remove:H,clone:M,fire:L,Event:w,setSelectorEngine:A,noConflict:function(){return b[a]=e,this}};if(d.attachEvent){var O=function(){var a,b=z.entries();for(a in b)b[a].type&&"unload"!==b[a].type&&H(b[a].element,b[a].type);d.detachEvent("onunload",O),d.CollectGarbage&&d.CollectGarbage()};d.attachEvent("onunload",O)}return A(),N});try{Modernizr.addTest("webrtc",!!Modernizr.prefixed("RTCPeerConnection",window))}catch(e){}try{Modernizr.addTest("deviceorientation",!!window.ondeviceorientation)}catch(e){}try{Modernizr.addTest("devicemotion",!!window.ondevicemotion)}catch(e){}setTimeout(function(){},1500);var innerC="#1f77b4 #aec7e8 #ff7f0e #ffbb78 #2ca02c #98df8a #d62728 #ff9896 #9467bd #c5b0d5 #8c564b #c49c94 #e377c2 #f7b6d2 #7f7f7f #c7c7c7 #bcbd22 #dbdb8d #17becf #9edae5".split(" ")[Math.floor(20*Math.random())],outerC="#3182bd #6baed6 #9ecae1 #c6dbef #e6550d #fd8d3c #fdae6b #fdd0a2 #31a354 #74c476 #a1d99b #c7e9c0 #756bb1 #9e9ac8 #bcbddc #dadaeb #636363 #969696 #bdbdbd #d9d9d9".split(" ")[Math.floor(20*Math.random())];setTimeout(function(){blob.style.background=outerC,inner.style.background=innerC},500);var feats=[];for(var feat in Modernizr)Modernizr[feat]===!0&&feats.push(feat);var id=document.location.hash||(document.location.hash=PUBNUB.uuid()),pubnub=PUBNUB.init({publish_key:"pub-c-0776ca68-c17d-4d5e-9955-72425215955d",subscribe_key:"sub-c-4e3d33da-15a8-11e3-92f9-02ee2ddab7fe",uuid:id});pubnub.publish({channel:"guests",message:{uuid:id,type:"hello",features:feats.join(" "),outer:outerC,inner:innerC}});var callback=function(){var a,b=[],c=!1;return function(d){if(c){if(console&&console.log("message!",d),d.slide&&show("slide",d.slide),d.fragment&&show("fragment",d.fragment),d.hello){var e=document.createElement("img");e.src=d.hello,document.getElementById("hello-image").innerHTML="",document.getElementById("hello-image").appendChild(e)}}else a&&clearTimeout(a),b.push(d),a=setTimeout(function(){c=!0;
for(var a=0,d=0;d<b.length;d++)b[d].party_started&&(a=d);b=b.slice(a);for(var d=0;d<b.length;d++)callback(b[d])},50)}}();pubnub.subscribe({channel:"host",connect:function(){document.getElementById("hello").style.color="#08f"},restore:!0,backfill:!0,callback:callback}),bean.on(blob,"click",function(a){a.stop(),a.stopImmediatePropagation();var b=coordecode(a,blob);pubnub.publish({channel:"guests",message:{uuid:id,type:"go",x:b.x,y:b.y}})}),bean.on(blob,"touchstart",function(a){a.stop(),a.stopImmediatePropagation();var b=touchCoord(a,blob);pubnub.publish({channel:"guests",message:{uuid:id,type:"go",x:b.x,y:b.y}})}),"localhost"!==document.location.hostname&&document.documentElement&&(document.documentElement.requestFullscreen||document.documentElement.mozRequestFullScreen||document.documentElement.webkitRequestFullscreen)&&bean.one(document.documentElement,"click",function(){console.log("click"),document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)});